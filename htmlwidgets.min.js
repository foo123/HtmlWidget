/**
*  HtmlWidget
*  html widgets used as (template) plugins and/or standalone, for PHP, Node/JS, Python
*
*  @dependencies: FontAwesome, jQuery, DateX, HtmlWidget
*  @version: 0.8.0
*  https://github.com/foo123/HtmlWidget
*  https://github.com/foo123/components.css
*  https://github.com/foo123/jquery-ui-widgets
*  https://github.com/foo123/modelview-widgets
*
**/
!function(e,t,a){"use strict";function n(e,n,s){var l=s&&s[d]?s[d]:null;t.fn[e]=function(s){var i,o="string"==typeof s?"w_"+s:!1,r=c.call(arguments,1),d=this;return o?this.each(function(){var n,s=t.data(this,e);return"w_instance"===o?(d=s,!1):s?"w_dispose"===o||"w_destroy"===o?("function"==typeof s.w_dispose?s.w_dispose():"function"==typeof s.w_destroy?s.w_destroy():"function"==typeof s.dispose?s.dispose():"function"==typeof s.destroy?s.destroy():l&&("function"==typeof l.w_dispose?l.w_dispose.call(s):"function"==typeof l.w_destroy?l.w_destroy.call(s):"function"==typeof l.dispose?l.dispose.call(s):"function"==typeof l.destroy&&l.destroy.call(s)),s=null,t.removeData(this,e),!1):(i=s[o]||l&&l[o],"function"!=typeof i?!1:(n=i.apply(s,r),n!==s&&a!==n?(d=n&&n.jquery?d.pushStack(n.get()):n,!1):void 0)):!1}):(s=s||{},this.each(function(){var a=t.data(this,e);a?(i=a.w_option||l&&l.w_option,"function"==typeof i&&i.call(a,s)):(t.data(this,e,a=new n(this,s)),i=a.w_init||l&&l.w_init,"function"==typeof i&&i.call(a))})),d}}function s(e,t,a,n,s,l){var i,o,r={map:e,title:n,position:new google.maps.LatLng(t,a)};return"undefined"!==l.clickable&&(r.clickable=!!l.clickable),"undefined"!==l.draggable&&(r.draggable=!!l.draggable),"undefined"!==l.crossOnDrag&&(r.crossOnDrag=!!l.crossOnDrag),"undefined"!==l.visible&&(r.visible=!!l.visible),"undefined"!==l.icon&&(r.icon=l.icon),"undefined"!==l.zIndex&&(r.zIndex=l.zIndex),"undefined"!==l.shape&&(r.shape=l.shape),i=new google.maps.Marker(r),s&&(o=new google.maps.InfoWindow({content:s}),google.maps.event.addListener(i,"click",function(){o.open(e,i)})),i}function l(e,t){return"undefined"!=typeof DateX?(t=t||DateX.defaultLocale,function(a){return DateX.format(a,e,t)}):function(e){return e.toDateString()}}function i(e,t){if("undefined"!=typeof DateX){t=t||DateX.defaultLocale;var a=DateX.getParser(e,t);return function(e){return!!e&&a(e)}}return function(e){return new Date(Date.parse(e))}}{var o={VERSION:"0.8.0",widget:{}},r="hasOwnProperty",d="prototype",c=Array[d].slice,u=JSON.parse,f=JSON.stringify;Object[d].toString}o.removable=function m(e,a){var n=this;return n instanceof m?(n.w_init=function(){var n=t(e);n.hasClass("w-removable")||n.addClass("w-removable"),n.on("click.removable",a.handle||".w-remove-handle",function(){var e=t(this);e.fadeOut(400,function(t){var n=!0;"function"==typeof a.onremove&&(n=a.onremove.call(this,t)),!1!==n&&e.remove()})})},void(n.w_dispose=function(){t(e).off(".removable")})):new m(e,a)},o.selectable=function h(e,a){var n=this;return n instanceof h?(n.w_init=function(){var n=t(e);n.hasClass("w-selectable")||n.addClass("w-selectable"),n.on("click.selectable",a.handle||".w-select-handle",function(e){if(e.shiftKey){var n=t(this);a.selector&&(n=n.closest(a.selector)),n.hasClass("w-selected")?n.removeClass("w-selected"):n.addClass("w-selected")}})},n.w_clear=function(){t(e).children(".w-selected").removeClass("w-selected")},void(n.w_dispose=function(){t(e).off(".selectable")})):new h(e,a)},o.morphable=function p(e,a){var n=this;if(!(n instanceof p))return new p(e,a);var s=null;n.w_morph=function(n){if(n!==s){var l=t(e);s&&l.removeClass(a.modeClass.split("${MODE}").join(s)),s=n,s&&l.addClass(a.modeClass.split("${MODE}").join(s))}}},o.delayable=function w(e,a){var n=this;return n instanceof w?(n.w_init=function(){var a=t(e);a.hasClass("w-delayed")&&a.removeClass("w-delayed"),a.hasClass("w-undelayed")||a.addClass("w-undelayed"),a.children(".w-delayable-overlay").length||a.append('<div class="w-delayable-overlay"><div class="w-spinner w-spinner-dots"></div></div>')},n.w_enable=function(){var a=t(e);a.hasClass("w-delayed")||a.addClass("w-delayed").removeClass("w-undelayed")},void(n.w_disable=function(){var a=t(e);a.hasClass("w-delayed")&&a.addClass("w-undelayed").removeClass("w-delayed")})):new w(e,a)},o.disabable=function b(e,a){var n=this;return n instanceof b?(n.w_init=function(){var a=t(e);a.hasClass("w-delayed")&&a.removeClass("w-delayed"),a.hasClass("w-undelayed")||a.addClass("w-undelayed"),a.children(".w-disabable-overlay").length||a.append('<div class="w-disabable-overlay"></div>')},n.w_enable=function(){var a=t(e);a.hasClass("w-disabled")||a.addClass("w-disabled").removeClass("w-undisabled")},void(n.w_disable=function(){var a=t(e);a.hasClass("w-disabled")&&a.addClass("w-undisabled").removeClass("w-disabled")})):new b(e,a)},o.uploadable=function g(a,n){var s=this,l=120;return s instanceof g?(s.w_dispose=function(){var e=t(a);e.off(".uploadable"),e=null},void(s.w_init=function(){var n=t(a);n.on("click.uploadable",".w-upload-delete",function(){return n[0].imdata=null,n.find("._w-data").val(""),n.find("img").attr("src",""),!1}).on("click.uploadable",".w-upload-thumbnail",function(){var t=n.find("_w-data"),a=n[0].imdata||(t.val()?u(t.val()):null);return a&&(n[0].imdata||(n[0].imdata=a),e.open(a.original?a.original:a.image,"preview_"+n.attr("id"),"scrollbars=yes,resizable=yes,width="+a.width+",height="+a.height).focus()),!1}).on("change.uploadable","input._w-uploader[type=file]",function(e){var a,s=(t(this),e.target.files[0]||null);return s&&s.type.match("image")?(a=new FileReader,a.addEventListener("load",function(e){var t=e.target.result,a=new Image;a.addEventListener("load",function(){setTimeout(function(){var e,i=a.width,o=a.height,r=l,d=Math.round(l*o/i),c=document.createElement("canvas"),u=c.getContext("2d");c.width=r,c.height=d,u.drawImage(a,0,0,i,o,0,0,r,d),e=c.toDataURL("image/png"),n[0].imdata={name:s.name,width:i,height:o,image:t,thumb:e},n.find("_w-data").val(f(n[0].imdata)),n.find("img").attr("src",e)},10)}),a.src=t}),void a.readAsDataURL(s)):!1})})):new g(a,n)},o.gmap3=function v(e,a){function n(){l&&google.maps.event.addListenerOnce(l,"idle",function(){google.maps.event.trigger(l,"resize"),l.setCenter(new google.maps.LatLng(o,r))})}var l,i,o,r,d,c=this;return c instanceof v?(l=null,a=t.extend({type:"ROADMAP",markers:null,center:null,kml:null,responsive:!1},a||{}),c.w_init=function(){var c=a.center||{lat:0,lng:0,zoom:6};i=c.zoom||6,o=c.lat||0,r=c.lng||0,l=new google.maps.Map(e,{zoom:i,center:new google.maps.LatLng(o,r),mapTypeId:google.maps.MapTypeId[a.type]});var u,f,m=a.markers,h=m?m.length:0;for(u=0;h>u;u++)f=m[u],s(l,f.lat,f.lng,f.title||"",f.info,f);if(null!=a.kml){var p=new google.maps.KmlLayer(a.kml);p.setMap(l)}d=!!a.responsive,d&&t(e.parentNode||document.body).on("resize",n)},c.w_dispose=function(){d&&t(e.parentNode||document.body).off("resize",n),l=null},c.w_map=function(){return l},c.w_center=function(e){return arguments.length?void(l&&(o=e.lat,r=e.lng,l.setCenter(new google.maps.LatLng(o,r)))):{lat:o,lng:r}},c.w_add_marker=function(e){return l&&e?s(l,e.lat,e.lng,e.title||"",e.info||null,e):void 0},c.w_remove_marker=function(e){e&&e.setMap(null)},c.w_add_markers=function(e){if(l&&e){for(var t=0;t<e.length;t++){var a=e[t];e[t]=s(l,a.lat,a.lng,a.title||"",a.info,a)}return e}},void(c.w_remove_markers=function(e){if(e)for(var t=0;t<e.length;t++)e[t].setMap(null)})):new v(e,a)},o.suggest=function(){function a(e,s){n++,this.element=t(e),this.options=t.extend({},a.defaults,s),this.cache={},this.id="remotelist-"+n,this.options.param||(this.options.param=this.element.prop("name")||"q"),this._createDatalist(),this._bindEvents(this)}var n=0;return a.defaults={minLength:2,maxLength:-1,source:"",param:"",select:t.noop,renderItem:null},a.createOption=function(e){var a=t(document.createElement("option"));return e&&"string"!=typeof e||(e={value:e}),a.prop("value",e.value),e.label&&a.prop("label",e.label),a.data("optionData",e),a[0]},a[d]={selectedData:function(){var e=this.selectedOption();return e&&t(e).data("optionData")},selectedOption:function(){var e=null,a=this.val();return a&&(e=t('[value="'+a+'"]',this.element.prop("list"))[0]||null),e},search:function(e){var a,n,s,l,i=this,o=this.options,r=e;o.maxLength>-1&&(r=r.substr(o,o.maxLength)),this.doAjax=!1,this.cache[r]?this.setList(this.cache[r],r):this.currentAjax?this.doAjax=e:(this.element.addClass("list-search"),a={},a[o.param]=e,this.currentAjax=!0,l=function(){l.xhr&&l.xhr.abort&&l.xhr.abort(),i.currentAjax=!1,clearTimeout(l.timer),i.doAjax?i.search(i.doAjax):i.element.removeClass("list-search")},n=t.isFunction(o.source)?o.source:function(e,a,n,s,l){return t.ajax({dataType:"json",url:l,data:s,context:this,error:n,success:a})},s=function(e){i.setList(e,r),l()},l.timer=setTimeout(l,999),l.xhr=n(e,s,l,a,o.source))},setList:function(e,n){e||(e=[]),this.currentOptions!=e&&this.currentVal!==n&&(this.currentOptions=e,this.currentVal=n,this.cache[n]=e,e=t.map(e,a.createOption),this.datalistSelect.html(e),t.fn.updatePolyfill&&this.datalistSelect.updatePolyfill())},_createDatalist:function(){this.datalistSelect=this.element.prop("list"),this.datalistSelect||(this.datalistSelect=t('<datalist id="'+this.id+'"><select /></datalist>'),this.element.attr("list",this.id),this.element.after(this.datalistSelect)),this.datalistSelect=t("select",this.datalistSelect)},val:function(){return e.webshims&&webshims.getDataListVal?webshims.getDataListVal(this.element[0]):this.element.prop("value")},widget:function(){return this},_bindEvents:function(e){var a,n,s,l=e.options,i=function(){var n;return function(i){var o=e.val();if(o!==n&&(n=o,"change"==i||!s||s.toLowerCase()!=o.charAt(o.length-1).toLowerCase()))return e.selectedOption()?(clearTimeout(a),l.select&&l.select.call(e.element[0],t.Event("listselect")),e.element.trigger("listselect"),!0):void 0}}();e.element.on({"input focus":function(){var t=function(){var t=e.val();t.length>=l.minLength&&e.search(t)};return function(){clearTimeout(a),a=setTimeout(t,99)}}(),"input change":function(t){clearTimeout(n),"change"==t.type?(clearTimeout(a),e.element.is(":focus")&&i("change")):n=setTimeout(i,9)},keypress:function(){var e=function(){s=""};return function(t){s=String.fromCharCode(t.charCode),setTimeout(e,20)}}(),getoptioncontent:function(e,a){return l.renderItem?l.renderItem('<span class="option-value">'+a.item.value+"</span>",a.item.label&&'<span class="option-label">'+a.item.label+"</span>",t.data(a.item.elem,"optionData")):void 0}})}},a}(),n("selectable",o.selectable),n("removable",o.removable),n("morphable",o.morphable),n("delayable",o.delayable),n("disabable",o.disabable),n("uploadable",o.uploadable),n("suggest",o.suggest),n("gmap3",o.gmap3),t.htmlwidget=o,t.fn.htmlwidget=function(e,a,n,s){return a=a||{},"function"!=typeof n&&(n=!1),"function"!=typeof s&&(s=!1),this.each(function(){var d,c=this;if(o.widget[r](e)&&"function"==typeof o.widget[e])o.widget[e](this,a);else switch(d=t(c),e){case"delayable":n&&n(t,c),d.delayable(a),s&&s(t,c);break;case"disabable":n&&n(t,c),d.disabable(a),s&&s(t,c);break;case"morphable":n&&n(t,c),d.morphable({modeClass:d.attr("data-morphable-mode")||a.modeClass}),s&&s(t,c);break;case"upload":case"uploadable":n&&n(t,c),d.uploadable(a),s&&s(t,c);break;case"selectable":n&&n(t,c),d.selectable({selector:d.attr("data-selectable-item")||a.selector||".selectable-item",handle:d.attr("data-selectable-handle")||a.handle||".selectable-handle"}),s&&s(t,c);break;case"removable":n&&n(t,c),d.removable({handle:d.attr("data-removable-handle")||a.handle||".removable-handle"}),s&&s(t,c);break;case"draggable":"undefined"!=typeof t.fn.tinyDraggable&&(n&&n(t,c),d.tinyDraggable(a),s&&s(t,c));break;case"sortable":"undefined"!=typeof Sortable&&(n&&n(t,c),Sortable.create(c,{sort:!0,disabled:!1,delay:parseInt(d.attr("data-sortable-delay")||a.delay||0,10),animation:parseInt(d.attr("data-sortable-animation")||a.animation||400,10),draggable:d.attr("data-sortable-item")||a.draggable||a.item,handle:d.attr("data-sortable-handle")||a.handle||".sortable-handle"}),s&&s(t,c));break;case"autocomplete":case"autosuggest":case"suggest":n&&n(t,c);var u=d.parent(),f=d.attr("data-ajax"),m=d.attr("data-request-method")||"POST",h=d.attr("data-response-type")||"json";d.suggest({minLength:2,maxLength:-1,source:function(e,a){u.addClass("ajax"),t.ajax({url:f,type:m,dataType:h,data:{suggest:e},success:function(e){u.removeClass("ajax"),a(e)}})},select:a.select||function(){}}),s&&s(t,c);break;case"datetime":case"date":case"datepicker":if("undefined"!=typeof Pikaday){n&&n(t,c);var p=d.attr("data-datetime-format")||"Y-m-d";new Pikaday({field:c,encoder:l(p),decoder:i(p)}),s&&s(t,c)}break;case"timer":"undefined"!=typeof t.fn.Timer&&(n&&n(t,c),d.Timer(a),s&&s(t,c));break;case"colorpicker":case"color":"undefined"!=typeof t.fn.ColorPicker&&(n&&n(t,c),d.ColorPicker(a),s&&s(t,c));break;case"select":case"select2":"undefined"!=typeof t.fn.select2&&(n&&n(t,c),d.select2(a),s&&s(t,c));break;case"table":case"datatable":"undefined"!=typeof t.fn.dataTable&&(n&&n(t,c),d.dataTable(a).on("change","input.select_row",function(){this.checked?t(this).closest("tr").addClass("selected"):t(this).closest("tr").removeClass("selected")}),d.closest(".dataTables_wrapper").addClass("w-table-wrapper"),s&&s(t,c));break;case"modal":"undefined"!=typeof t.fn.modal&&(n&&n(t,c),d.modal(a),s&&s(t,c));break;case"modelview":"undefined"!=typeof ModelView&&(ModelView.jquery(t),n&&n(t,c),d.modelview(a),s&&s(t,c));break;case"wysiwyg-editor":"undefined"!=typeof t.fn.trumbowyg&&(n&&n(t,c),d.trumbowyg(a.editor||{}),d.closest(".trumbowyg-box").addClass("widget w-wysiwyg-editor-box").attr("style",a.style||""),s&&s(t,c));break;case"syntax-editor":"undefined"!=typeof CodeMirror&&(n&&n(t,c),CodeMirror.fromTextArea(c,a.editor||{}),s&&s(t,c));break;case"tag-editor":"undefined"!=typeof t.fn.tagEditor&&(n&&n(t,c),d.tagEditor(a),s&&s(t,c));break;case"map":case"gmap":case"gmap3":n&&n(t,c),d.gmap3(a),s&&s(t,c)}}),this},t(function(){t(".w-date").htmlwidget("date"),t(".w-timer").htmlwidget("timer"),t(".w-color,.w-colorselector").htmlwidget("color"),t(".w-selectable").htmlwidget("selectable"),t(".w-removable").htmlwidget("removable"),t(".w-delayable").htmlwidget("delayable"),t(".w-disabable").htmlwidget("disabable"),t(".w-morphable").htmlwidget("morphable"),t(".w-sortable").htmlwidget("sortable")})}(window,jQuery);