/**
*  Tao
*  A simple, tiny, isomorphic, precise and fast template engine for handling both string and live dom based templates
*
*  @version: 0.3.4
*  https://github.com/foo123/Tao.js
*
**/
!function(e,t,i){"use strict";"object"==typeof exports?module.exports=i():"function"==typeof define&&define.amd?define(function(){return i()}):e[t]=i()}(this,"Tao",function(e){"use strict";function t(e,t,n,s){var r;return n=!0===n,e?e.substr&&e.substring?(e=a(e,t[h]?t:new RegExp(t.source,t[f]?"gi":"g"),n,s),r=function u(e){var t,s,l,r,h,f,p,o=u.tpl[1],g=o.length,a=[],d="";for(s=0;g>s;s++)t=o[s],l=t[0],h=t[1],r=t[2],l?(n&&!h&&t[3]>-1&&a.length&&(r=r.slice(0,t[3])+"<!--"+a.join("\n")+"-->"+r.slice(t[3]),a=[]),d+=r):((f=t[6])?(p=c(r,e,f),p[0]&&(t[3]=String(p[1]))):e[i](r)&&(t[3]=String(e[r])),n?h?(d+=t[3],t[4]&&a.push("att:"+t[4]+"|key:"+r+"|"+[t[5],t[3].length].join(","))):d+="<!--key:"+r+"-->"+t[3]+"<!--/key-->":d+=t[3]);return d}):(e=d(e,t[h]?new RegExp(t.source,t[f]?"i":""):t,n,s),r=function o(e){var t,n,s,r,u,h,f,g,a,d,x,b,S,v,C,y,O,k=o.tpl[0];for(r=p(k),f=r.length,h=0;f>h;h++){if(u=r[h],a=k[u],b=a[2]){if(S=c(u,e,b),!S[0])continue;g=String(S[1])}else{if(!e[i](u))continue;g=String(e[u])}for(d=a[0],n=0,s=d.length;s>n;n++)d[n][0][l]=g;for(x=a[1],n=0,s=x.length;s>n;n++){if(t=x[n],v=t[1],y=v.length,O=y?v[0][l]:"",y>1)for(C=1;y>C;C++)O+=v[C][l];t[0][l]=O}}}):r=function(){},r.tpl=e,r.dispose=function(){r.tpl=null},r}var i="hasOwnProperty",n="lastIndexOf",s="match",l="nodeValue",r="nodeType",u="parentNode",h="global",f="ignoreCase",p=Object.keys,o=/[a-zA-Z0-9_\-]/,g=function(e){return parseInt(e||0,10)||0},c=function(e,t,i){var n,s=e.split(i||"."),l=s.length-1,r=t;for(n=0;l>n;n++){if(null==r[s[n]]){r=null;break}r=r[s[n]]}return r?[1,r[s[l]]]:[0,null]},a=function(t,s,l,r){for(var u,h,f,p,g,c,a,d,x,b,S=[],v=0,C=!1,y=-1,O=0,k=!1,T={},m=!!r;u=s.exec(t);){if(h=s.lastIndex-u[0].length,f=t.slice(v,h),x=-1,l&&(a=f[n]("<"),d=f[n](">"),a>d?(x=-1,k=!0):d>a&&(x=d+1,k=!1)),S.push([1,k,f,x]),k)if(-1<(g=f[n]("="))){for(C="",c=g;g>-1&&o.test(p=f.charAt(--g));)C=p+C;y=h-v-c-2,O=y+u[0].length}else C&&(y=O+h-v-2-1,O+=y+u[0].length);else C=!1,O=0,y=-1;b=u[1]?u[1]:u[0],T[i](b)?T[b].push(S.length):T[b]=[S.length],S.push([0,k,b,e,C,y,m&&-1<b.indexOf(r)?r:0]),v=s.lastIndex}return f=t.slice(v),x=-1,l&&(a=f[n]("<"),d=f[n](">"),a>d?(x=-1,k=!0):d>a&&(x=d+1,k=!1)),S.push([1,k,f,x]),[T,S]},d=function(e,t,n,h){var f,p,o,c,a,d,x,b,S,v,C,y,O,k,T,m,w,I,j,E,N,R=!!h;if(p=[],o=[],v=e,v.attributes&&(a=v.attributes.length))if(n&&v.firstChild&&8===v.firstChild[r]&&"att:"===v.firstChild[l].slice(0,4))for(b=v.firstChild[l].split("\n"),a=b.length,k={},c=0;a>c;c++)d=b[c].split("|"),w=d[0].slice(4),C=v.attributes[w],k[i](w)||(k[w]=[1,[]],o.push([C,k[w],v])),k[w][1].push([d[1].slice(4),d[2].split(",").map(g)]);else for(c=0;a>c;c++)C=v.attributes[c],(d=C[l][s](t))&&o.push([C,d,v]);if(3===v[r])n&&v.previousSibling&&v.nextSibling&&8===v.previousSibling[r]&&8===v.nextSibling[r]&&"key:"===(y=v.previousSibling[l]).slice(0,4)&&"/key"===v.nextSibling[l]?(d=[v[l],y.slice(4)],p.push([v,d,v[u]])):(d=v[l][s](t))&&p.push([v,d,v[u]]);else if(v.firstChild)for(N=[v=v.firstChild];N.length;){if(v.attributes&&(a=v.attributes.length))if(n&&v.firstChild&&8===v.firstChild[r]&&"att:"===v.firstChild[l].slice(0,4))for(b=v.firstChild[l].split("\n"),a=b.length,k={},c=0;a>c;c++)d=b[c].split("|"),w=d[0].slice(4),C=v.attributes[w],k[i](w)||(k[w]=[1,[]],o.push([C,k[w],v])),k[w][1].push([d[1].slice(4),d[2].split(",").map(g)]);else for(c=0;a>c;c++)C=v.attributes[c],(d=C[l][s](t))&&o.push([C,d,v]);if(v.firstChild)N.push(v=v.firstChild);else{for(3===v[r]&&(n&&v.previousSibling&&v.nextSibling&&8===v.previousSibling[r]&&8===v.nextSibling[r]&&"key:"===(y=v.previousSibling[l]).slice(0,4)&&"/key"===v.nextSibling[l]?(d=[v[l],y.slice(4)],p.push([v,d,v[u]])):(d=v[l][s](t))&&p.push([v,d,v[u]])),v=N.pop();N.length&&!v.nextSibling;)v=N.pop();v.nextSibling&&N.push(v=v.nextSibling)}}for(f={},c=0,a=p.length;a>c;c++)if(x=p[c],E=x[0],d=x[1],v=x[2],m=E[l],m.length>d[0].length){do y=d[1]?d[1]:d[0],O=E.splitText(d.index),E=O.splitText(d[0].length),f[i](y)?f[y][0].push([O,v]):f[y]=[[[O,v]],[],R&&-1<y.indexOf(h)?h:0],d=E[l][s](t);while(d)}else y=d[1]?d[1]:d[0],O=E,f[i](y)?f[y][0].push([O,v]):f[y]=[[[O,v]],[],R&&-1<y.indexOf(h)?h:0];for(c=0,a=o.length;a>c;c++)if(x=o[c],C=x[0],d=x[1],v=x[2],m=C[l],E=document.createTextNode(m||""),T=[[],[E]],1===d[0])for(b=d[1],S=b.length,j=0,c=0;S>c;c++)I=b[c],y=I[0],O=E.splitText(I[1][0]-j),E=O.splitText(I[1][1]),T[0].push(y),T[1].push(O,E),f[i](y)?(f[y][0].push([O,v]),f[y][1].push([C,T[1],m,v])):f[y]=[[[O,v]],[[C,T[1],m,v]],R&&-1<y.indexOf(h)?h:0],j+=I[1][1]+I[1][0];else if(m.length>d[0].length){do y=d[1]?d[1]:d[0],O=E.splitText(d.index),E=O.splitText(d[0].length),T[0].push(y),T[1].push(O,E),f[i](y)?(f[y][0].push([O,v]),f[y][1].push([C,T[1],m,v])):f[y]=[[[O,v]],[[C,T[1],m,v]],R&&-1<y.indexOf(h)?h:0],d=E[l][s](t);while(d)}else O=E,y=d[1]?d[1]:d[0],T[0].push(y),f[i](y)?(f[y][0].push([O,v]),f[y][1].push([C,T[1],m,v])):f[y]=[[[O,v]],[[C,T[1],m,v]],R&&-1<y.indexOf(h)?h:0];return[f,e]};return t.VERSION="0.3.4",t});