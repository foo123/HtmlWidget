/*
JQuery Location Picker plugin
https://github.com/Logicify/jquery-locationpicker-plugin
Dmitry Berezovsky, Logicify (<http://logicify.com/>)
*/
!function(n){function o(n,o){var t=new google.maps.Map(n,o),e=new google.maps.Marker({position:new google.maps.LatLng(54.19335,-3.92695),map:t,title:"Drag Me",draggable:o.draggable});return{map:t,marker:e,circle:null,location:e.position,radius:o.radius,locationName:o.locationName,addressComponents:{formatted_address:null,addressLine1:null,addressLine2:null,streetName:null,streetNumber:null,city:null,state:null,stateOrProvince:null},settings:o.settings,domContainer:n,geodecoder:new google.maps.Geocoder}}function t(n){return void 0!=e(n)}function e(o){return n(o).data("locationpicker")}function a(n,o){if(n){var t=l.locationFromLatLng(o.location);n.latitudeInput&&n.latitudeInput.val(t.latitude),n.longitudeInput&&n.longitudeInput.val(t.longitude),n.radiusInput&&n.radiusInput.val(o.radius),n.locationNameInput&&n.locationNameInput.val(o.locationName)}}function i(o,t){o&&(o.radiusInput&&o.radiusInput.on("change",function(){t.radius=n(this).val(),l.setPosition(t,t.location,function(n){n.settings.onchanged.apply(t.domContainer,[l.locationFromLatLng(n.location),n.radius,!1])})}),o.locationNameInput&&t.settings.enableAutocomplete&&(t.autocomplete=new google.maps.places.Autocomplete(o.locationNameInput.get(0)),google.maps.event.addListener(t.autocomplete,"place_changed",function(){var n=t.autocomplete.getPlace();return n.geometry?void l.setPosition(t,n.geometry.location,function(n){a(o,n),n.settings.onchanged.apply(t.domContainer,[l.locationFromLatLng(n.location),n.radius,!1])}):void t.settings.onlocationnotfound(n.name)})),o.latitudeInput&&o.latitudeInput.on("change",function(){l.setPosition(t,new google.maps.LatLng(n(this).val(),t.location.lng()),function(n){n.settings.onchanged.apply(t.domContainer,[l.locationFromLatLng(n.location),n.radius,!1])})}),o.longitudeInput&&o.longitudeInput.on("change",function(){l.setPosition(t,new google.maps.LatLng(t.location.lat(),n(this).val()),function(n){n.settings.onchanged.apply(t.domContainer,[l.locationFromLatLng(n.location),n.radius,!1])})}))}var l={drawCircle:function(o,t,e,a){return null!=o.circle&&o.circle.setMap(null),e>0?(e*=1,a=n.extend({strokeColor:"#0000FF",strokeOpacity:.35,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.2},a),a.map=o.map,a.radius=e,a.center=t,o.circle=new google.maps.Circle(a),o.circle):null},setPosition:function(n,o,t){n.location=o,n.marker.setPosition(o),n.map.panTo(o),this.drawCircle(n,o,n.radius,{}),n.settings.enableReverseGeocode?n.geodecoder.geocode({latLng:n.location},function(o,e){e==google.maps.GeocoderStatus.OK&&o.length>0&&(n.locationName=o[0].formatted_address,n.addressComponents=l.address_component_from_google_geocode(o[0].address_components)),t&&t.call(this,n)}):t&&t.call(this,n)},locationFromLatLng:function(n){return{latitude:n.lat(),longitude:n.lng()}},address_component_from_google_geocode:function(n){for(var o={},t=n.length-1;t>=0;t--){var e=n[t];e.types.indexOf("postal_code")>=0?o.postalCode=e.short_name:e.types.indexOf("street_number")>=0?o.streetNumber=e.short_name:e.types.indexOf("route")>=0?o.streetName=e.short_name:e.types.indexOf("sublocality")>=0?o.city=e.short_name:e.types.indexOf("administrative_area_level_1")>=0?o.stateOrProvince=e.short_name:e.types.indexOf("country")>=0&&(o.country=e.short_name)}return o.addressLine1=[o.streetNumber,o.streetName].join(" ").trim(),o.addressLine2="",o}};n.fn.locationpicker=function(r,s){if("string"==typeof r){var c=this.get(0);if(!t(c))return;var u=e(c);switch(r){case"location":if(void 0==s){var d=l.locationFromLatLng(u.location);return d.radius=u.radius,d.name=u.locationName,d}s.radius&&(u.radius=s.radius),l.setPosition(u,new google.maps.LatLng(s.latitude,s.longitude),function(n){a(n.settings.inputBinding,n)});break;case"subscribe":if(void 0==s)return null;var g=s.event,m=s.callback;if(!g||!m)return console.error('LocationPicker: Invalid arguments for method "subscribe"'),null;google.maps.event.addListener(u.map,g,m);break;case"map":if(void 0==s){var p=l.locationFromLatLng(u.location);return p.formattedAddress=u.locationName,p.addressComponents=u.addressComponents,{map:u.map,marker:u.marker,location:p}}return null}return null}return this.each(function(){var e=n(this);if(!t(this)){var s=n.extend({},n.fn.locationpicker.defaults,r),c=new o(this,{zoom:s.zoom,center:new google.maps.LatLng(s.location.latitude,s.location.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,disableDoubleClickZoom:!1,scrollwheel:s.scrollwheel,streetViewControl:!1,radius:s.radius,locationName:s.locationName,settings:s,draggable:s.draggable});e.data("locationpicker",c),google.maps.event.addListener(c.marker,"dragend",function(){l.setPosition(c,c.marker.position,function(n){var o=l.locationFromLatLng(c.location);n.settings.onchanged.apply(c.domContainer,[o,n.radius,!0]),a(c.settings.inputBinding,c)})}),l.setPosition(c,new google.maps.LatLng(s.location.latitude,s.location.longitude),function(n){a(s.inputBinding,c),n.settings.oninitialized(e);var o=l.locationFromLatLng(c.location);s.onchanged.apply(c.domContainer,[o,n.radius,!1])}),i(s.inputBinding,c)}})},n.fn.locationpicker.defaults={location:{latitude:40.7324319,longitude:-73.82480799999996},locationName:"",radius:500,zoom:15,scrollwheel:!0,inputBinding:{latitudeInput:null,longitudeInput:null,radiusInput:null,locationNameInput:null},enableAutocomplete:!1,enableReverseGeocode:!0,draggable:!0,onchanged:function(){},onlocationnotfound:function(){},oninitialized:function(){}}}(jQuery);