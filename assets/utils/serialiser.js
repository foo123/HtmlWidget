/**
*  Serialiser.js
*  Parse, serialise and url-encode/decode complex form fields to/from an object model / FormData
*
*  @version: 0.5.1
*  https://github.com/foo123/serialiser.js
*
**/
!function(e,n,t){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(e.$deps=e.$deps||{})&&(e.EXPORTED_SYMBOLS=[n])&&(e[n]=e.$deps[n]=t.call(e)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=t.call(e)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(n,[],function(r){r(n,t.call(e))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return t.moduleUri=n.uri,t.call(e)}):n in e||(e[n]=t.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[n]})}(this,"Serialiser",function(e){"use strict";function t(e,n){if("function"==typeof e)return e;if(n){var t=q("^"+V(n)+"([\\.\\[].+)$");return function(n){var r,o=n[T](e);return o&&(r=o.match(t))?r[1]:null}}return function(n){return n[T](e)}}function r(n,t){return"function"==typeof n?n:!1!==t?function(t){var r=t[j]("data-alt-value")?t[T]("data-alt-value"):null,o=("value"===n?B(t):t[T](n))||"",i=(t[T]("type")||t[F]||"").toLowerCase();return"file"===i?r&&null!=t[r]&&t[r].length?t[r]:t.files&&t.files.length?t.files:null:("checkbox"!==i&&"radio"!==i||t[w])&&("select"!==i||o.length&&-1!==t[$])&&("text"!==i&&"textarea"!==i||X(o).length)?o:e}:function(t){var r=t[j]("data-alt-value")?t[T]("data-alt-value"):null,o=("value"===n?B(t):t[T](n))||"",i=(t[T]("type")||t[F]).toLowerCase();return"file"===i?r&&null!=t[r]&&t[r].length?t[r]:t.files&&t.files.length?t.files:null:"checkbox"!==i&&"radio"!==i||t[w]?o:e}}function o(e,n,o,i,l,u){n=n||{},o=t(o||"name"),i=r(i||"value"),arguments.length<5&&(l=!1),u=!0===u;for(var a=0,f=e.length;f>a;a++){var c,s,d,p,h,g,y=e[a],m=!1,A=l?!!y[T](l):!1;if(c=o(y),c&&(s=i(y),null!=s)){A&&(s=s?C(s):null);var m=K.test(c);for(d=W(c).split("."),h=n;d.length;)if(p=d.shift(),d.length){if(v.call(h,p))!u&&_.test(d[0])&&h[p].length<=(g=parseInt(d[0],10))&&(h[p]=h[p].concat(new Array(g-h[p].length+1)));else if(m&&1===d.length){if(s instanceof FileList){h[p]=s;break}h[p]=[]}else!u&&_.test(d[0])?h[p]=new Array(parseInt(d[0],10)+1):h[p]={};h=h[p]}else m?h.push(s):h[p]=s}}return n}function u(e,n){var t,r,o,i,l,u,a,f;for("data:"===e.substr(0,5)?(-1<(f=e.indexOf(";base64,"))?(o=e.slice(5,f),e=e.slice(f+8),t=S(e)):(o=e.slice(5,f=e.indexOf(",")),e=e.slice(f+1),t=unescape(e)),null==n&&(n=o)):t=e,u=t.length,r=new Uint8Array(u),l=15&u,i=0;l>i;i++)r[i]=255&t.charCodeAt(i);for(i=l;u>i;i+=16)a=i,r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++);return new Blob([r],{type:n})}function a(e,t,r,o){t=t||{},r=!!r,o=!0===o;var u,a,f,c,s,d,p={"true":!0,"false":!1,"null":null,undefined:void 0};for(u=e.replace(/%20|\+/g," ").split("&"),i=0,l=u.length;i<l;i++){a=u[i].split("="),f=I(a[0]),c=a.length>1?I(a[1]):r?void 0:"",r&&(c=c&&!isNaN(c)&&+c+""===c?+c:"undefined"==typeof c?void 0:v.call(p,c)?p[c]:c);var h=K.test(f);for(f=W(f).split("."),s=t;f.length;)d=f.shift(),f.length?(v.call(s,d)?!o&&_.test(f[0])&&s[d].length<=(n=parseInt(f[0],10))&&(s[d]=s[d].concat(new Array(n-s[d].length+1))):h&&1===f.length?s[d]=[]:!o&&_.test(f[0])?s[d]=new Array(parseInt(f[0],10)+1):s[d]={},s=s[d]):h?s.push(c):s[d]=c}return t}function f(e,n,t,r){var o,i,l;if(r)if(Y(n))if(K.test(r))for(i=0,l=n.length;l>i;i++)t(e,r,n[i]);else for(i=0,l=n.length;l>i;i++)f(e,n[i],t,r+"["+("object"==typeof n[i]?i:"")+"]");else if(n instanceof FileList)for(i=0,l=n.length;l>i;i++)t(e,r,n[i]);else if(n instanceof File||n instanceof Blob)t(e,r,n);else if(n&&"object"==typeof n)for(o in n)n[v](o)&&f(e,n[o],t,r+"["+o+"]");else t(e,r,n);else if(Y(n))for(i=0,l=n.length;l>i;i++)t(e,n[i].name,n[i].value);else if(n instanceof FileList)for(i=0,l=n.length;l>i;i++)t(e,r,n[i]);else if(n instanceof File||n instanceof Blob)t(e,r,n);else if(n&&"object"==typeof n)for(o in n)v.call(n,o)&&f(e,n[o],t,o);return e}function c(e,n,t){"function"==typeof t&&(t=t()),e.push(b(n)+"="+b(null==t?"":t))}function s(e,n,t){var r=f(n||[],e||{},c);return!0!==t&&(r=r.join("&").split("%20").join("+")),r}function d(e,n,t){if("function"==typeof t&&(t=t()),t instanceof FileList)for(var r=0,o=t.length;o>r;r++)e.append(n,t[r],t[r].name);else t instanceof File?e.append(n,t,t.name):e.append(n,null==t?"":t)}function p(e,n,t){return null==t&&"undefined"!=typeof FormData&&(t=FormData),t&&e instanceof t?e:f(n||new t,e||{},d)}function h(e){return A(e||{})}function g(){return!0}function y(){return!1}var v=Object.prototype.hasOwnProperty,m=Object.prototype.toString,A=JSON.stringify,C=JSON.parse,S=atob,b=(btoa,encodeURIComponent),I=decodeURIComponent,T="getAttribute",j="hasAttribute",w="checked",E="disabled",O="selected",F="tagName",x="type",L="value",N="options",$="selectedIndex",M="parentNode",R="innerText",D="textContent",U=function(e){var n=e.attributes[L];return!n||n.specified?e[L]:e.text},k=function(e){for(var n,t,r=e[N],o=e[$],i="select-one"===e[x]||0>o,l=i?null:[],u=i?o+1:r.length,a=0>o?u:i?o:0;u>a;a++)if(t=r[a],(t[O]||a===o)&&!t[E]&&(!t[M][E]||"optgroup"!==t[M][F].toLowerCase())){if(n=U(t),i)return n;l.push(n)}return l},B=function(e){if(e){var n=null;switch(e[j]("data-alt-value")&&(n=e[T]("data-alt-value")),e[F].toLowerCase()){case"input":return"file"===e.type.toLowerCase()?n&&null!=e[n]&&e[n].length?e[n]:e.files.length?e.files:null:n&&null!=e[n]?e[n]:e[L];case"textarea":return n&&null!=e[n]?e[n]:e[L];case"select":return n&&null!=e[n]?e[n]:k(e);default:return n&&null!=e[n]?e[n]:D in e?e[D]:e[R]}}},P=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,V=function(e){return e.replace(P,"\\$&")},q=function(e,n){return new RegExp(e,n||"")},J=/^\s+|\s+$/g,X=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(J,"")},_=/^\d+$/,H=/\[([^\]]*)\]/g,K=/\[\s*\]$/,Q=/^\.+/g,W=function(e){return e.replace(H,".$1").replace(Q,"")},Y=function(e){return"[object Array]"===m.call(e)};return{VERSION:"0.5.1",Type:{COMPOSITE:function(){var e=arguments;return e[0]&&e[0].concat&&(e=e[0]),function(n,t,r,o,i){for(var l=e.length;l--;)n=e[l](n,t,r,o,i);return n}},DEFAULT:function(e){return function(n){return(null==n||"[object String]"===m.call(n)&&!X(n).length)&&(n=e),n}},BOOL:function(e){if("[object String]"===m.call(e)&&e.length){var n=e.toLowerCase();return"true"===n||"on"===n||"yes"===n||"1"===n}return!!e},INT:function(e){return parseInt(e||0,10)||0},FLOAT:function(e){return parseFloat(e||0,10)||0},STR:function(e){return String(e)},MIN:function(e){return function(n){return e>n?e:n}},MAX:function(e){return function(n){return n>e?e:n}},CLAMP:function(e,n){if(e>n){var t=n;n=e,e=t}return function(t){return e>t?e:t>n?n:t}}},Validator:{PASS:g,FAIL:y,NOT:function(e){return function(n,t,r,o,i){return!e(n,t,r,o,i)}},AND:function(e,n){return function(t,r,o,i,l){return e(t,r,o,i,l)&&n(t,r,o,i,l)}},EITHER:function(e,n){return function(t,r,o,i,l){return e(t,r,o,i,l)||n(t,r,o,i,l)}},IIF:function(e,n,t){return t=t||g,function(r,o,i,l,u){return e(r,o,i,l,u)?n(r,o,i,l,u):t(r,o,i,l,u)}},REQUIRED:function(e){var n=m.call(e);return"[object String]"==n||"[object Array]"==n?!!e.length:null!=e},IS:function(e,n,t){return!0===t?function(t,r,o){return n===o[e]}:function(t,r,o){return n==o[e]}},BETWEEN:function(e,n,t){if(e>n){var r=e;e=n,n=r}return!0===t?function(t){return t>e&&n>t}:function(t){return t>=e&&n>=t}},MATCHES:function(e){return function(n){return e.test(n)}},EXPRESSION:function(e,n){return n=n||{},new Function([String(n.value||"value"),String(n.key||"key"),String(n.model||"model"),String(n.index||"index"),String(n.model_key||String(n.model||"model")+"_key")].join(","),"return ("+e+");")}},Typecast:function(e,n){if(n)for(var t in n)if(v.call(n,t)){var r=n[t];if("[object Array]"===m.call(r)){if(v.call(e,t)){var o,i=e[t],l=i.length,r=r[0];for(o=0;l>o;o++)i[o]=r(i[o],t,e,o,i)}}else e[t]=r(e[t],t,e)}return e},Validate:function(e,n,t,r){var o=!0;if(r=r||"",n)for(var i in n)if(v.call(n,i)){var l=n[i];if("[object Array]"===m.call(l[0]))if(v.call(e,i)){var u,a=l[0][0],f=e[i],c=f.length,s=new Array(c),d=!1,p=l[1];for(u=0;c>u;u++)a(f[u],i,e,u,f)||(s[u]=p,d=!0);d&&(t[r+i]=s,o=!1)}else o=!1;else l[0](e[i],i,e)||(t[r+i]=l[1],o=!1)}return o},Key:t,Value:r,DataUriToBlob:u,FieldsToModel:o,UrlEncodedToModel:a,ModelToJSON:h,ModelToFormData:p,ModelToUrlEncoded:s}});