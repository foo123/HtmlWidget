/**
*  area-select.js
*  A simple js class to select rectabgular regions in DOM elements (image, canvas, video, etc..)
*  @VERSION: 0.5.0
*
*  https://github.com/foo123/area-select.js
*  @author: Nikos M.  http://nikos-web-development.netai.net/
*
**/
!function(e,t,i){"use strict";var n;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(e.EXPORTED_SYMBOLS=[t])&&(e[t]=i.call(e)):"object"==typeof module&&module.exports?module.exports=i.call(e):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(){return i.call(e)}):t in e||(e[t]=n=i.call(e))&&"function"==typeof define&&define.amd&&define(function(){return n})}(this,"AreaSelect",function(t){"use strict";function i(e){var t=document.createElement("div");return e&&(t.className=e),t}function n(e,t){return e.classList?e.classList.contains(t):-1!==(" "+e.className+" ").indexOf(" "+t+" ")}function l(e,t){n(e,t)||(e.classList?e.classList.add(t):e.className=""===e.className?t:e.className+" "+t)}function s(e,t){e.classList?e.classList.remove(t):e.className=w((" "+e.className+" ").replace(" "+t+" "," "))}function o(e,t,i){e.attachEvent?e.attachEvent("on"+t,i):e.addEventListener(t,i)}function a(e,t,i){e.detachEvent?e.detachEvent("on"+t,i):e.removeEventListener(t,i)}function r(e){e.__area_select_draggable=e.draggable||!1,e.draggable=!1,e.onmousedown=function(e){return e=e||window.event,e.preventDefault&&e.preventDefault(),!1}}function h(e,n){var r=this;if(!(r instanceof h))return new h(e,n);n=n||{},r.element(e),r.selection=null;var c=r.area={x:0,y:0,w:0,h:0};c.main=i(n.className?"area-select marching-ants "+n.className:"area-select marching-ants"),c.main.appendChild(c.n=i("area-select-resize area-select-resize-n")),c.main.appendChild(c.e=i("area-select-resize area-select-resize-e")),c.main.appendChild(c.s=i("area-select-resize area-select-resize-s")),c.main.appendChild(c.w=i("area-select-resize area-select-resize-w")),c.main.appendChild(c.nw=i("area-select-resize area-select-resize-nw")),c.main.appendChild(c.ne=i("area-select-resize area-select-resize-ne")),c.main.appendChild(c.sw=i("area-select-resize area-select-resize-sw")),c.main.appendChild(c.se=i("area-select-resize area-select-resize-se")),c.main.style.position="absolute",c.main.style.display="none",c.main.style.left="0px",c.main.style.top="0px",c.main.style.width="0px",c.main.style.height="0px",c.n.__RESIZE=b,c.s.__RESIZE=W,c.n__DIR="n",c.s.__DIR="s",c.e.__RESIZE=_,c.w.__RESIZE=v,c.e__DIR="e",c.w.__DIR="w",c.ne.__RESIZE=b|_,c.nw.__RESIZE=b|v,c.se.__RESIZE=W|_,c.sw.__RESIZE=W|v,c.ne__DIR="ne",c.nw.__DIR="nw",c.se__DIR="se",c.sw.__DIR="sw",e.parentNode.appendChild(c.main),r.options={minWidth:null!=n.minWidth?m(n.minWidth):null,minHeight:null!=n.minHeight?m(n.minHeight):null,maxWidth:null!=n.maxWidth?m(n.maxWidth):null,maxHeight:null!=n.maxHeight?m(n.maxHeight):null,ratioX:null!=n.ratioX?f(n.ratioX):null,ratioY:null!=n.ratioY?f(n.ratioY):null,withBorders:t!==n.withBorders?!!n.withBorders:!1,onSelect:"function"==typeof n.onSelect?n.onSelect:null};var p=0,w=0,C=0,I=0,z=y,T=function(e){if(e=e||window.event,r.el===e.target){var t=r.options,i=r.el,n=r.area,s=i.getBoundingClientRect(),a={left:i.offsetLeft,top:i.offsetTop,width:i.offsetWidth,height:i.offsetHeight,scrollLeft:i.scrollLeft,scrollTop:i.scrollTop},h=S(i),c=t.withBorders?m(h.borderLeftWidth):0,d=t.withBorders?m(h.borderTopWidth):0;p=e.clientX-c-s.left,w=e.clientY-d-s.top,0>p?p=0:p>=a.width&&(p=a.width-1),0>w?w=0:w>=a.height&&(w=a.height-1),z=x,n.main.style.display="block",n.x=p,n.y=w,n.w=0,n.h=0,n.main.style.left=a.left-a.scrollLeft+n.x+"px",n.main.style.top=a.top-a.scrollTop+n.y+"px",n.main.style.width="0px",n.main.style.height="0px",n.main.style.cursor="se-resize",l(i,"area-selecting"),o(H.body,"mousemove",N),o(H.body,"mouseup",Z)}},B=function(e){if(e=e||window.event,r.area.main===e.target){var t=r.options,i=r.el,n=r.area,s=i.getBoundingClientRect(),a={width:i.offsetWidth,height:i.offsetHeight},h=S(i),c=t.withBorders?m(h.borderLeftWidth):0,d=t.withBorders?m(h.borderTopWidth):0;p=e.clientX-c-s.left,w=e.clientY-d-s.top,0>p?p=0:p>=a.width&&(p=a.width-1),0>w?w=0:w>=a.height&&(w=a.height-1),z=g,n.main.style.cursor="move",l(i,"area-selecting"),o(H.body,"mousemove",N),o(H.body,"mouseup",Z)}},D=function(e){e=e||window.event;var t=e.target,i=r.area;if(i.n===t||i.s===t||i.e===t||i.w===t||i.ne===t||i.nw===t||i.se===t||i.sw===t){var n=r.options,s=r.el,a=s.getBoundingClientRect(),h={width:s.offsetWidth,height:s.offsetHeight},c=S(s),d=n.withBorders?m(c.borderLeftWidth):0,u=n.withBorders?m(c.borderTopWidth):0;p=e.clientX-d-a.left,w=e.clientY-u-a.top,0>p?p=0:p>=h.width&&(p=h.width-1),0>w?w=0:w>=h.height&&(w=h.height-1),z=t.__RESIZE||0,i.x0=i.x,i.y0=i.y,i.x1=i.x+i.w,i.y1=i.y+i.h,i.main.style.cursor="se-resize",l(s,"area-selecting"),o(H.body,"mousemove",N),o(H.body,"mouseup",Z)}},N=function(e){e=e||window.event;var t,i,n=r.options,l=r.el,s=r.area,o=l.getBoundingClientRect(),a={left:l.offsetLeft,top:l.offsetTop,width:l.offsetWidth,height:l.offsetHeight,scrollLeft:l.scrollLeft,scrollTop:l.scrollTop},h=S(l),c=n.withBorders?m(h.borderLeftWidth):0,u=n.withBorders?m(h.borderTopWidth):0,f="e",y="s";if(C=e.clientX-c-o.left,I=e.clientY-u-o.top,0>C?C=0:C>=a.width&&(C=a.width-1),0>I?I=0:I>=a.height&&(I=a.height-1),x&z)t=s.w,i=s.h,p>C?(s.x=C,s.w=p-C,f="w"):(s.x=p,s.w=C-p),w>I?(s.y=I,s.h=w-I,y="n"):(s.y=w,s.h=I-w),null!=n.minWidth&&s.w<n.minWidth&&(s.w=n.minWidth),null!=n.minHeight&&s.h<n.minHeight&&(s.h=n.minHeight),null!=n.maxWidth&&s.w>n.maxWidth&&(s.w=n.maxWidth),null!=n.maxHeight&&s.h>n.maxHeight&&(s.h=n.maxHeight),s.x+s.w>a.width&&(s.w=a.width-s.x-1),s.y+s.h>a.height&&(s.h=a.height-s.y-1),s.main.style.left=a.left-a.scrollLeft+s.x+"px",s.main.style.top=a.top-a.scrollTop+s.y+"px",s.main.style.width=s.w+"px",s.main.style.height=s.h+"px",2>d(t-s.w)&&(f=""),2>d(i-s.h)&&(y=""),f||y||(f="se"),s.main.style.cursor=y+f+"-resize";else if(g&z){if(s.main!==e.target)return;s.x+=C-p,s.y+=I-w,p=C,w=I,s.x+s.w>=a.width?s.x=a.width-s.w-1:s.x<0&&(s.x=0),s.y+s.h>=a.height?s.y=a.height-s.h-1:s.y<0&&(s.y=0),s.main.style.left=a.left-a.scrollLeft+s.x+"px",s.main.style.top=a.top-a.scrollTop+s.y+"px",s.main.style.cursor="move"}else R&z&&(E&z&&(_&z?C<s.x0?(s.x=C,s.w=s.x0-C):(s.x=s.x0,s.w=C-s.x0):C>s.x1?(s.x=s.x1,s.w=C-s.x1):(s.x=C,s.w=s.x1-C),s.w<0&&(s.w=-s.w),null!=n.minWidth&&s.w<n.minWidth&&(s.w=n.minWidth),null!=n.maxWidth&&s.w>n.maxWidth&&(s.w=n.maxWidth),s.x+s.w>a.width&&(s.w=a.width-s.x-1),s.main.style.left=a.left-a.scrollLeft+s.x+"px",s.main.style.width=s.w+"px"),L&z&&(W&z?I<s.y0?(s.y=I,s.h=s.y0-I):(s.y=s.y0,s.h=I-s.y0):I>s.y1?(s.y=s.y1,s.h=I-s.y1):(s.y=I,s.h=s.y1-I),s.h<0&&(s.h=-s.h),null!=n.minHeight&&s.h<n.minHeight&&(s.h=n.minHeight),null!=n.maxHeight&&s.h>n.maxHeight&&(s.h=n.maxHeight),s.y+s.h>a.height&&(s.h=a.height-s.y-1),s.main.style.top=a.top-a.scrollTop+s.y+"px",s.main.style.height=s.h+"px"),s.main.style.cursor=e.target.__DIR+"-resize")},Z=function(e){var t=r.el,i=r.area,n=r.options;e=e||window.event,r.selection={x1:u(i.x),y1:u(i.y),x2:u(i.x+i.w),y2:u(i.y+i.h)},p=w=C=I=0,s(t,"area-selecting"),i.main.style.cursor="",z=y,a(H.body,"mousemove",N),a(H.body,"mouseup",Z),n.onSelect&&setTimeout(function(){n.onSelect.call(r,r.el,r.getSelection())},10)};o(e,"mousedown",e.__area_select_evt=T),o(c.n,"mousedown",D),o(c.s,"mousedown",D),o(c.e,"mousedown",D),o(c.w,"mousedown",D),o(c.ne,"mousedown",D),o(c.nw,"mousedown",D),o(c.se,"mousedown",D),o(c.sw,"mousedown",D),o(c.main,"mousedown",B)}var c="0.5.0",d=Math.abs,u=Math.round,m=function(e){return parseInt(e||0,10)||0},f=function(e){return parseFloat(e||0,10)||0},p=/^\s+|\s+$/g,w=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(p,"")},y=0,x=1,g=2,_=4,v=8,b=16,W=32,E=_|v,L=b|W,R=E|L,S="function"==typeof window.getComputedStyle?function(e){return window.getComputedStyle(e,null)}:function(e){return e.currentStyle},H=window.document;return h.VERSION=c,h.prototype={constructor:h,el:null,area:null,selection:null,options:null,dispose:function(){var t=this,i=t.el,n=t.area;return t.deselect(),i&&(i.__area_select_evt&&(a(i,"mousedown",i.__area_select_evt),i.__area_select_evt=null),n&&n.main&&i.parentNode.removeChild(n.main),e.draggable=i.__area_select_draggable,i.__area_select_draggable=null,s(i,"area-selectable")),t.el=null,t.area=null,t.selection=null,t.options=null,t},element:function(e){return r(this.el=e),l(this.el,"area-selectable"),this},reset:function(){var e=this;return e.selection=null,e.options={},e},show:function(){return this.area.main.style.display="block",this.area.main.style.cursor="",this},hide:function(){return this.area.main.style.display="none",this.area.main.style.cursor="",this},select:function(e){var t=this,i=t.el,n=t.area;return"object"==typeof e?(n.x=e.x1,n.y=e.y1,n.w=e.x2-e.x1,n.h=e.y2-e.y1,n.main.style.left=i.offsetLeft-i.scrollLeft+n.x+"px",n.main.style.top=i.offsetTop-i.scrollTop+n.y+"px",n.main.style.width=n.w+"px",n.main.style.height=n.h+"px",t.selection={x1:u(n.x),y1:u(n.y),x2:u(n.x+n.w),y2:u(n.y+n.h)}):!1===e&&(t.selection=null),t},deselect:function(){return this.selection=null,this.hide()},getSelection:function(){var e=this.selection;return e?{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,width:d(e.x2-e.x1),height:d(e.y2-e.y1)}:null}},h});