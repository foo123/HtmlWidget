/**
*  area-select.js
*  A simple js class to select rectabgular regions in DOM elements (image, canvas, video, etc..)
*  @VERSION: 1.0.0
*
*  https://github.com/foo123/area-select.js
*  @author: Nikos M.  http://nikos-web-development.netai.net/
*
**/
!function(e,t,i){"use strict";var n;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(e.EXPORTED_SYMBOLS=[t])&&(e[t]=i.call(e)):"object"==typeof module&&module.exports?module.exports=i.call(e):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(){return i.call(e)}):t in e||(e[t]=n=i.call(e))&&"function"==typeof define&&define.amd&&define(function(){return n})}(this,"AreaSelect",function(t){"use strict";function i(e){var t=document.createElement("div");return e&&(t.className=e),t}function n(e,t){return e.classList?e.classList.contains(t):-1!==(" "+e.className+" ").indexOf(" "+t+" ")}function a(e,t){n(e,t)||(e.classList?e.classList.add(t):e.className=""===e.className?t:e.className+" "+t)}function l(e,t){e.classList?e.classList.remove(t):e.className=p((" "+e.className+" ").replace(" "+t+" "," "))}function s(e,t,i){e.attachEvent?e.attachEvent("on"+t,i):e.addEventListener(t,i)}function o(e,t,i){e.detachEvent?e.detachEvent("on"+t,i):e.removeEventListener(t,i)}function r(e){e.__area_select_draggable=e.draggable||!1,e.draggable=!1,e.onmousedown=function(e){return e=e||window.event,e.preventDefault&&e.preventDefault(),!1}}function h(e,n){var r=this;if(!(r instanceof h))return new h(e,n);n=n||{},r.element(e),r.selection=null;var c=r.area={x:0,y:0,w:0,h:0};c.main=i(n.className?"area-select area-select-marching-ants "+n.className:"area-select area-select-marching-ants"),c.main.appendChild(c.__n=i("area-select-resize area-select-resize-n")),c.main.appendChild(c.__e=i("area-select-resize area-select-resize-e")),c.main.appendChild(c.__s=i("area-select-resize area-select-resize-s")),c.main.appendChild(c.__w=i("area-select-resize area-select-resize-w")),c.main.appendChild(c.__nw=i("area-select-resize area-select-resize-nw")),c.main.appendChild(c.__ne=i("area-select-resize area-select-resize-ne")),c.main.appendChild(c.__sw=i("area-select-resize area-select-resize-sw")),c.main.appendChild(c.__se=i("area-select-resize area-select-resize-se")),c.main.style.position="absolute",c.main.style.display="none",c.main.style.left="0px",c.main.style.top="0px",c.main.style.width="0px",c.main.style.height="0px",c.__n.__RESIZE=b,c.__n.__DIR="n",c.__s.__RESIZE=W,c.__s.__DIR="s",c.__e.__RESIZE=g,c.__e.__DIR="e",c.__w.__RESIZE=v,c.__w.__DIR="w",c.__ne.__RESIZE=b|g,c.__ne.__DIR="ne",c.__nw.__RESIZE=b|v,c.__nw.__DIR="nw",c.__se.__RESIZE=W|g,c.__se.__DIR="se",c.__sw.__RESIZE=W|v,c.__sw.__DIR="sw",e.parentNode.appendChild(c.main),r.options={minWidth:null!=n.minWidth?u(n.minWidth):null,minHeight:null!=n.minHeight?u(n.minHeight):null,maxWidth:null!=n.maxWidth?u(n.maxWidth):null,maxHeight:null!=n.maxHeight?u(n.maxHeight):null,ratioXY:null!=n.ratioXY?_(n.ratioXY):null,ratioYX:null!=n.ratioYX?_(n.ratioYX):null,withBorders:t!==n.withBorders?!!n.withBorders:!1,onSelect:"function"==typeof n.onSelect?n.onSelect:null};var f=0,p=0,H=0,I=0,C=w,X=function(e){if(e=e||window.event,r.el===e.target){var t,i=r.options,n=r.el,l=r.area,o=n.getBoundingClientRect(),h={left:n.offsetLeft,top:n.offsetTop,width:n.offsetWidth,height:n.offsetHeight,scrollLeft:n.scrollLeft,scrollTop:n.scrollTop},c=0,d=0;i.withBorders?(t=S(n),c=u(t.borderLeftWidth),d=u(t.borderTopWidth)):(c=0,d=0),f=e.clientX-c-o.left,p=e.clientY-d-o.top,0>f?f=0:f>=h.width&&(f=h.width-1),0>p?p=0:p>=h.height&&(p=h.height-1),C=y,l.main.style.display="block",l.x=f,l.y=p,l.w=0,l.h=0,l.main.style.left=h.left-h.scrollLeft+l.x+"px",l.main.style.top=h.top-h.scrollTop+l.y+"px",l.main.style.width="0px",l.main.style.height="0px",l.main.style.cursor="se-resize",a(n,"area-selecting"),a(l.main,"area-select-active"),a(l.main,"area-select-create"),s(z.body,"mousemove",D),s(z.body,"mouseup",B)}},Y=function(e){if(e=e||window.event,r.area.main===e.target){var t,i=r.options,n=r.el,l=r.area,o=n.getBoundingClientRect(),h={width:n.offsetWidth,height:n.offsetHeight},c=0,d=0;i.withBorders?(t=S(n),c=u(t.borderLeftWidth),d=u(t.borderTopWidth)):(c=0,d=0),f=e.clientX-c-o.left,p=e.clientY-d-o.top,0>f?f=0:f>=h.width&&(f=h.width-1),0>p?p=0:p>=h.height&&(p=h.height-1),C=x,l.main.style.cursor="move",a(n,"area-selecting"),a(l.main,"area-select-active"),a(l.main,"area-select-move"),s(z.body,"mousemove",D),s(z.body,"mouseup",B)}},T=function(e){e=e||window.event;var t=e.target,i=r.area;if(i.__n===t||i.__s===t||i.__e===t||i.__w===t||i.__ne===t||i.__nw===t||i.__se===t||i.__sw===t){var n,l=r.options,o=r.el,h=o.getBoundingClientRect(),c={width:o.offsetWidth,height:o.offsetHeight},d=0,m=0;l.withBorders?(n=S(o),d=u(n.borderLeftWidth),m=u(n.borderTopWidth)):(d=0,m=0),f=e.clientX-d-h.left,p=e.clientY-m-h.top,0>f?f=0:f>=c.width&&(f=c.width-1),0>p?p=0:p>=c.height&&(p=c.height-1),C=t.__RESIZE||0,i.x0=i.x,i.y0=i.y,i.x1=i.x+i.w,i.y1=i.y+i.h,i.main.style.cursor=(t.__DIR||"se")+"-resize",a(o,"area-selecting"),a(i.main,"area-select-active"),a(i.main,"area-select-resize"),s(z.body,"mousemove",D),s(z.body,"mouseup",B)}},D=function(e){e=e||window.event;var t,i,n,a=r.options,l=r.el,s=r.area,o=l.getBoundingClientRect(),h={left:l.offsetLeft,top:l.offsetTop,width:l.offsetWidth,height:l.offsetHeight,scrollLeft:l.scrollLeft,scrollTop:l.scrollTop},c=0,_=0,w="e",z="s";if(a.withBorders?(t=S(l),c=u(t.borderLeftWidth),_=u(t.borderTopWidth)):(c=0,_=0),H=e.clientX-c-o.left,I=e.clientY-_-o.top,0>H?H=0:H>=h.width&&(H=h.width-1),0>I?I=0:I>=h.height&&(I=h.height-1),y&C)i=s.w,n=s.h,f>H?(s.x=H,s.w=f-H,w="w"):(s.x=f,s.w=H-f),p>I?(s.y=I,s.h=p-I,z="n"):(s.y=p,s.h=I-p),a.ratioYX?s.h=m(s.w*a.ratioYX):a.ratioXY&&(s.w=m(s.h*a.ratioXY)),null!=a.minWidth&&s.w<a.minWidth&&(s.w=a.minWidth),null!=a.minHeight&&s.h<a.minHeight&&(s.h=a.minHeight),null!=a.maxWidth&&s.w>a.maxWidth&&(s.w=a.maxWidth),null!=a.maxHeight&&s.h>a.maxHeight&&(s.h=a.maxHeight),s.x+s.w>h.width&&(s.w=h.width-s.x-1),s.y+s.h>h.height&&(s.h=h.height-s.y-1),s.main.style.left=h.left-h.scrollLeft+s.x+"px",s.main.style.top=h.top-h.scrollTop+s.y+"px",s.main.style.width=s.w+"px",s.main.style.height=s.h+"px",2>d(i-s.w)&&(w=""),2>d(n-s.h)&&(z=""),w||z||(w="se"),s.main.style.cursor=z+w+"-resize";else if(x&C){if(s.main!==e.target)return;s.x+=H-f,s.y+=I-p,f=H,p=I,s.x+s.w>=h.width?s.x=h.width-s.w-1:s.x<0&&(s.x=0),s.y+s.h>=h.height?s.y=h.height-s.h-1:s.y<0&&(s.y=0),s.main.style.left=h.left-h.scrollLeft+s.x+"px",s.main.style.top=h.top-h.scrollTop+s.y+"px",s.main.style.cursor="move"}else R&C&&(g&C&&(H<s.x0?(s.x=H,s.w=s.x0-H):(s.x=s.x0,s.w=H-s.x0)),v&C&&(H>s.x1?(s.x=s.x1,s.w=H-s.x1):(s.x=H,s.w=s.x1-H)),W&C&&(I<s.y0?(s.y=I,s.h=s.y0-I):(s.y=s.y0,s.h=I-s.y0)),b&C&&(I>s.y1?(s.y=s.y1,s.h=I-s.y1):(s.y=I,s.h=s.y1-I)),a.ratioYX?E&C?s.h=m(s.w*a.ratioYX):s.w=m(s.h/a.ratioYX):a.ratioXY&&(L&C?s.w=m(s.h*a.ratioXY):s.h=m(s.w/a.ratioXY)),null!=a.minWidth&&s.w<a.minWidth&&(s.w=a.minWidth),null!=a.maxWidth&&s.w>a.maxWidth&&(s.w=a.maxWidth),null!=a.minHeight&&s.h<a.minHeight&&(s.h=a.minHeight),null!=a.maxHeight&&s.h>a.maxHeight&&(s.h=a.maxHeight),s.x+s.w>h.width&&(s.w=h.width-s.x-1),s.y+s.h>h.height&&(s.h=h.height-s.y-1),s.main.style.left=h.left-h.scrollLeft+s.x+"px",s.main.style.top=h.top-h.scrollTop+s.y+"px",s.main.style.width=s.w+"px",s.main.style.height=s.h+"px",s.main.style.cursor=e.target.__DIR+"-resize")},B=function(e){var t=r.el,i=r.area,n=r.options;e=e||window.event,r.selection={x1:m(i.x),y1:m(i.y),x2:m(i.x+i.w),y2:m(i.y+i.h)},f=p=H=I=0,o(z.body,"mousemove",D),o(z.body,"mouseup",B),y&C?l(i.main,"area-select-create"):x&C?l(i.main,"area-select-move"):R&C&&l(i.main,"area-select-resize"),l(i.main,"area-select-active"),l(t,"area-selecting"),i.main.style.cursor="",C=w,n.onSelect&&setTimeout(function(){n.onSelect.call(r,r.el,r.getSelection())},10)};s(e,"mousedown",e.__area_select_evt=X),s(c.__n,"mousedown",T),s(c.__s,"mousedown",T),s(c.__e,"mousedown",T),s(c.__w,"mousedown",T),s(c.__ne,"mousedown",T),s(c.__nw,"mousedown",T),s(c.__se,"mousedown",T),s(c.__sw,"mousedown",T),s(c.main,"mousedown",Y)}var c="1.0.0",d=Math.abs,m=Math.round,u=function(e){return parseInt(e||0,10)||0},_=function(e){return parseFloat(e||0,10)||0},f=/^\s+|\s+$/g,p=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(f,"")},w=0,y=1,x=2,g=4,v=8,b=16,W=32,E=g|v,L=b|W,R=E|L,S="function"==typeof window.getComputedStyle?function(e){return window.getComputedStyle(e,null)}:function(e){return e.currentStyle},z=window.document;return h.VERSION=c,h.prototype={constructor:h,el:null,area:null,selection:null,options:null,dispose:function(){var t=this,i=t.el,n=t.area;return t.deselect(),i&&(i.__area_select_evt&&(o(i,"mousedown",i.__area_select_evt),i.__area_select_evt=null),n&&n.main&&i.parentNode.removeChild(n.main),e.draggable=i.__area_select_draggable,i.__area_select_draggable=null,l(i,"area-selectable")),t.el=null,t.area=null,t.selection=null,t.options=null,t},element:function(e){return r(this.el=e),a(this.el,"area-selectable"),this},reset:function(){var e=this;return e.selection=null,e.options={},e},show:function(){return this.area.main.style.display="block",this.area.main.style.cursor="",this},hide:function(){return this.area.main.style.display="none",this.area.main.style.cursor="",this},select:function(e){var t=this,i=t.el,n=t.area;return"object"==typeof e?(n.x=e.x1,n.y=e.y1,n.w=e.x2-e.x1,n.h=e.y2-e.y1,n.main.style.left=i.offsetLeft-i.scrollLeft+n.x+"px",n.main.style.top=i.offsetTop-i.scrollTop+n.y+"px",n.main.style.width=n.w+"px",n.main.style.height=n.h+"px",t.selection={x1:m(n.x),y1:m(n.y),x2:m(n.x+n.w),y2:m(n.y+n.h)}):!1===e&&(t.selection=null),t},deselect:function(){return this.selection=null,this.hide()},getSelection:function(){var e=this.selection;return e?{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,width:d(e.x2-e.x1),height:d(e.y2-e.y1)}:null}},h});