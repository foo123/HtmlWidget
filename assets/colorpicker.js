/**
*
* Color Picker Widget
*
* adapted from: http://www.eyecon.ro/colorpicker/
*      Color Picker by Stefan Petre www.eyecon.ro (MIT and GPL)
*/
!function(e){"use strict";function o(){var e="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}}function i(e,o,i){if(e===o)return!0;if(e.contains)return e.contains(o);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(o));for(var t=o.parentNode;t&&t!==i;){if(t===e)return!0;t=t.parentNode}return!1}function t(e){return e=parseInt(e,16),[e>>16&255,e>>8&255,255&e]}function r(e){var o=0,i=0,t=0,r=e[0],n=e[1],c=e[2],a=C(r,n,c),s=P(r,n,c),l=s-a;return t=s,i=0!=s?255*l/s:0,o=0!=i?r===s?(n-c)/l:n===s?2+(c-r)/l:4+(r-n)/l:-1,o*=60,0>o&&(o+=360),i*=100/255,t*=100/255,[A(o),A(i),A(t)]}function n(e){var o,i,t,r=A(e[0]),n=A(255*e[1]/100),c=A(255*e[2]/100);if(0===n)o=i=t=c;else{var a=c,s=(255-n)*c/255,l=(a-s)*(r%60)/60;360==r&&(r=0),60>r?(o=a,t=s,i=s+l):120>r?(i=a,t=s,o=a-l):180>r?(i=a,o=s,t=s+l):240>r?(t=a,o=s,i=a-l):300>r?(t=a,i=s,o=s+l):360>r?(o=a,i=s,t=a-l):(o=0,i=0,t=0)}return[A(o),A(i),A(t)]}function c(e){var o=[e[0].toString(16),e[1].toString(16),e[2].toString(16)];return 1===o[0].length&&(o[0]="0"+o[0]),1===o[1].length&&(o[1]="0"+o[1]),1===o[2].length&&(o[2]="0"+o[2]),o[0]+o[1]+o[2]}function a(e){e="#"===e.charAt(0)?e.slice(1):e;var o=6-e.length;return o>0&&(e=3===o?e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2):new Array(o+1).join("0")+e),e}function s(e,o){e.substr&&(e=e.slice(o?5:4,-1).split(z));var i=o?Y.opacity(e[3]):null;return[Y.hsb[0](e[0]),Y.hsb[1](e[1]),Y.hsb[2](e[2]),i]}function l(e,o){e.substr&&(e=e.slice(o?5:4,-1).split(z));var i=o?Y.opacity(e[3]):null;return[Y.rgb[0](e[0]),Y.rgb[1](e[1]),Y.rgb[2](e[2]),i]}function d(e){return parseInt(e,10)}function u(e){return parseFloat(e,10)}function b(e,o,i){return"function"==typeof i?function(t){return t=i(t),t>o?o:e>t?e:t}:function(i){return i>o?o:e>i?e:i}}function f(e){return function(o){return e.test(o)}}function p(e){return'    <div id="'+e+'" class="w-colorpicker">    <button class="w-colorpicker_satur_bright"><div></div></button>    <button class="w-colorpicker_hue"><div></div></button>    <div class="w-colorpicker_new_color w-colorpicker_transparent">    <button class="w-colorpicker_color" id="'+e+'_color1""></button>    </div>    <div class="w-colorpicker_current_color w-colorpicker_transparent">    <button class="w-colorpicker_color" id="'+e+'_color2"></button>    </div>    <div class="w-colorpicker_field" data-field="hex">    <input id="'+e+'_hex" type="text" maxlength="6" size="6" value=""/>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="rgb.0">    <input id="'+e+'_rgb_0" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="rgb.1">    <input id="'+e+'_rgb_1" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="rgb.2">    <input id="'+e+'_rgb_2" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="hsb.0">    <input id="'+e+'_hsb_0" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="hsb.1">    <input id="'+e+'_hsb_1" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="hsb.2">    <input id="'+e+'_hsb_2" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <button class="w-colorpicker_submit"></button>    </div>    '}function h(e,o,i){var t,r,n,c,a=!0;if(Y[o])if(t=Y[o],S(t))for(n=0,c=t.length;c>n;n++)i[n]=t[n](i[n]);else i=t(i);if(M[o]){if(r=M[o],S(r)){for(n=0,c=r.length;c>n;n++)if(!r[n](i[n])){a=!1;break}}else r(i)||(a=!1);a&&(e[o]=i)}return a}function v(e,o,i){var t,r=!1;return null!=i&&(e.opacity=Y.opacity(i),r=!0),o&&(S(o)?(3<o.length&&(i=o[3],o=o.slice(0,3)),h(e,"rgb",o)&&(null!=i&&(e.opacity=Y.opacity(i)),m(e,"rgb"),r=!0)):o.substr&&("rgba"===o.slice(0,4)?(t=l(o,!0),e.rgb=[t[0],t[1],t[2]],e.opacity=Y.opacity(t[3]),m(e,"rgb"),r=!0):"rgb"===o.slice(0,3)?(t=l(o),e.rgb=[t[0],t[1],t[2]],m(e,"rgb"),r=!0):"hsla"===o.slice(0,4)?(t=s(o,!0),e.hsb=[t[0],t[1],t[2]],e.opacity=Y.opacity(t[3]),m(e,"hsb"),r=!0):"hsl"===o.slice(0,3)?(t=s(o),e.hsb=[t[0],t[1],t[2]],m(e,"hsb"),r=!0):h(e,"hex",a(o))&&(m(e,"hex"),r=!0))),r}function g(e,o){return"rgba"===o?"rgba("+e.rgb[0]+","+e.rgb[1]+","+e.rgb[2]+","+e.opacity+")":"rgb"===o?"rgb("+e.rgb[0]+","+e.rgb[1]+","+e.rgb[2]+")":"hsla"===o?"hsla("+e.hsb[0]+","+e.hsb[1]+","+e.hsb[2]+","+e.opacity+")":"hsl"===o?"hsl("+e.hsb[0]+","+e.hsb[1]+","+e.hsb[2]+")":"#"+e.hex}function m(e,o){"hsb"===o?(e.rgb=n(e.hsb),e.hex=c(e.rgb)):"rgb"===o?(e.hsb=r(e.rgb),e.hex=c(e.rgb)):"hex"===o&&(e.rgb=t(e.hex),e.hsb=r(e.rgb))}function _(e,o,i){var t=g(e,"rgba");o.hsb[0].val(e.hsb[0]),o.hsb[1].val(e.hsb[1]),o.hsb[2].val(e.hsb[2]),o.rgb[0].val(e.rgb[0]),o.rgb[1].val(e.rgb[1]),o.rgb[2].val(e.rgb[2]),o.hex.val(e.hex),o.color1.css("background-color",t),i&&o.color2.css("background-color",t)}function w(e,o,i,t,r){o&&e.val(t),i&&e.css("background-color",t),e.prop("selectedColor",t),r&&e.trigger(r)}function k(){}function y(e){return E({bindEvent:"click",changeEvent:"colorchange",onShow:k,onBeforeShow:k,onHide:k,format:"rgba",color:"ff0000",opacity:1,livePreview:!0},e||{})}function x(t,r){var n,c,a,s,l,u,b,f,h,k,S,E,z,Y,M,T,D,N,W,j,B=this,I=0,L=0,O=0,X=!1,F=!1;return B instanceof x?(T=function(e){27===e.keyCode&&M(!0)},M=function Q(o){s.hasClass("w-colorpicker-visible")&&(!0===o||o.target!==t[0]&&!i(s[0],o.target,s[0]))&&(!1!==r.onHide(B)&&s.removeClass("w-colorpicker-visible"),e(document).unbind("keyup",T).unbind("mousedown",Q))},Y=function(){if(!s.hasClass("w-colorpicker-visible")){r.onBeforeShow(B);var i=e(this).offset(),t=o(),n=i.top+this.offsetHeight,c=i.left;n+176>t.t+t.h&&(n-=this.offsetHeight+176),c+356>t.l+t.w&&(c-=356),s.css({left:c+"px",top:n+"px"}),!1!==r.onShow(B)&&s.addClass("w-colorpicker-visible"),e(document).bind("keyup",T).bind("mousedown",M)}return!1},l=function(o){if(!I){var i=this,t=e(i.parentNode).addClass("w-colorpicker_slider"),r=t.find("input").focus(),n=t.attr("data-field"),c=n.slice(0,3),a={el:t,field:r,type:n,key:c,index:d(n.slice(-1)),max:"hsb.0"===n?360:"hsb"===c?100:255,val:d(r.val()),y:o.pageY};I=1,e(document).bind("mouseup",a,b).bind("mousemove",a,u)}},u=function(e){var o=e.data.key,i=e.data.index;return D[o][i]=P(0,C(e.data.max,d(e.data.val+e.pageY-e.data.y))),r.livePreview&&(m(D,o),_(D,N)),!1},b=function(o){return e(document).unbind("mouseup",b).unbind("mousemove",u),I=0,m(D,o.data.key),_(D,N),o.data.el.removeClass("w-colorpicker_slider").find("input").focus(),!1},f=function(){if(!L){var o={y:e(this).offset().top};L=1,e(document).bind("mouseup",o,k).bind("mousemove",o,h)}},h=function(e){return D.hsb[0]=A(360*(148-P(0,C(148,e.pageY-e.data.y)))/148),r.livePreview&&(m(D,"hsb"),_(D,N)),!1},k=function(){return e(document).unbind("mouseup",k).unbind("mousemove",h),L=0,m(D,"hsb"),_(D,N),!1},S=function(){if(!O){var o={pos:e(this).offset()};O=1,e(document).bind("mouseup",o,z).bind("mousemove",o,E)}},E=function(e){return D.hsb[1]=A(100*P(0,C(150,e.pageX-e.data.pos.left))/150),D.hsb[2]=A(100*(150-P(0,C(150,e.pageY-e.data.pos.top)))/150),r.livePreview&&(m(D,"hsb"),_(D,N)),!1},z=function(){return e(document).unbind("mouseup",z).unbind("mousemove",E),O=0,m(D,"hsb"),_(D,N),!1},B.dispose=function(){e.removeData(t,"ColorPicker"),B.ui=null,s.remove()},B.setColor=function(e,o){v(D,e,o)&&_(D,N,!0)},B.getColor=function(e){return g(D,e||W)},B.value=function(e,o){return arguments.length?void(v(D,e,o)&&_(D,N,!0)):g(D,W)},r=y(r),a=e(t),e.data(t,"ColorPicker",B),W=a.attr("data-color-format")||r.format||"rgba",j=a.attr("data-color-change")||r.changeEvent,X=a.hasClass("w-colorselector"),F=a.is("input,textarea"),c=r.id||"colorpicker_ui_"+ ++H,s=e(p(c)),D={opacity:1,hsb:[0,0,0],rgb:[0,0,0],hex:"000000"},N={hsb:[s.find("#"+c+"_hsb_0"),s.find("#"+c+"_hsb_1"),s.find("#"+c+"_hsb_2")],rgb:[s.find("#"+c+"_rgb_0"),s.find("#"+c+"_rgb_1"),s.find("#"+c+"_rgb_2")],hex:s.find("#"+c+"_hex"),color1:s.find("#"+c+"_color1"),color2:s.find("#"+c+"_color2")},s.on("mousedown",".w-colorpicker_satur_bright",S).on("mousedown",".w-colorpicker_hue",f).on("mousedown","[data-field] > span",l).on("click","#"+c+"_color1,.w-colorpicker_submit",function(){_(D,N,!0),n=D.rgb.slice(),M&&M(!0),w(a,F,X,g(D,W),j)}).on("click","#"+c+"_color2",function(){v(D,n),_(D,N,!0)}),B.ui=s,v(D,a.attr("data-color")||r.color,a.attr("data-opacity")||r.opacity),n=D.rgb.slice(),_(D,N,!0),a.hasClass("w-colorpicker-flat")?s.addClass("w-colorpicker-flat").appendTo(a).show():(s.appendTo(document.body),a.bind(r.bindEvent,Y),w(a,F,X,g(D,W))),a.hasClass("w-colorpicker-light")&&s.addClass("w-colorpicker-light"),a.hasClass("w-colorpicker-transition-fade")&&s.addClass("w-colorpicker-transition-fade"),void(a.hasClass("w-colorpicker-transition-slide")&&s.addClass("w-colorpicker-transition-slide"))):new x(t,r)}var C=Math.min,P=Math.max,A=Math.round,S=e.isArray,E=e.extend,z=/\s*,\s*/g,H=0,Y={opacity:b(0,1,u),hsb:[b(0,360,d),b(0,100,d),b(0,100,d)],rgb:[b(0,255,d),b(0,255,d),b(0,255,d)]},M={hex:f(/^[0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f]$/i)};e.ColorPicker=x,e.fn.ColorPicker=function(o){var i=arguments,t=this;return this.each(function(){var r=this,n=e.data(r,"ColorPicker");if(n){if("dispose"===o)n.dispose();else if("value"===o){if(!(i.length>1))return t=n.value(),!1;n.value(i[1])}}else new x(r,o)}),t}}(jQuery);