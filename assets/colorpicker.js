/**
*
* Color Picker Widget
*
* adapted from: http://www.eyecon.ro/colorpicker/
*      Color Picker by Stefan Petre www.eyecon.ro (MIT and GPL)
*/
!function(e){"use strict";function o(){var e="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}}function r(e,o,r){if(e===o)return!0;if(e.contains)return e.contains(o);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(o));for(var i=o.parentNode;i&&i!==r;){if(i===e)return!0;i=i.parentNode}return!1}function i(e){return e=parseInt(e,16),[e>>16&255,e>>8&255,255&e]}function t(e){var o=0,r=0,i=0,t=e[0],n=e[1],c=e[2],a=C(t,n,c),s=P(t,n,c),l=s-a;return i=s,r=0!=s?255*l/s:0,o=0!=r?t===s?(n-c)/l:n===s?2+(c-t)/l:4+(t-n)/l:-1,o*=60,0>o&&(o+=360),r*=100/255,i*=100/255,[A(o),A(r),A(i)]}function n(e){var o,r,i,t=A(e[0]),n=A(255*e[1]/100),c=A(255*e[2]/100);if(0===n)o=r=i=c;else{var a=c,s=(255-n)*c/255,l=(a-s)*(t%60)/60;360==t&&(t=0),60>t?(o=a,i=s,r=s+l):120>t?(r=a,i=s,o=a-l):180>t?(r=a,o=s,i=s+l):240>t?(i=a,o=s,r=a-l):300>t?(i=a,r=s,o=s+l):360>t?(o=a,r=s,i=a-l):(o=0,r=0,i=0)}return[A(o),A(r),A(i)]}function c(e){var o=[e[0].toString(16),e[1].toString(16),e[2].toString(16)];return 1===o[0].length&&(o[0]="0"+o[0]),1===o[1].length&&(o[1]="0"+o[1]),1===o[2].length&&(o[2]="0"+o[2]),o[0]+o[1]+o[2]}function a(e){e="#"===e.charAt(0)?e.slice(1):e;var o=6-e.length;return o>0&&(e=3===o?e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2):new Array(o+1).join("0")+e),e}function s(e,o){e.substr&&(e=e.slice(o?5:4,-1).split(z));var r=o?Y.opacity(e[3]):null;return[Y.hsb[0](e[0]),Y.hsb[1](e[1]),Y.hsb[2](e[2]),r]}function l(e,o){e.substr&&(e=e.slice(o?5:4,-1).split(z));var r=o?Y.opacity(e[3]):null;return[Y.rgb[0](e[0]),Y.rgb[1](e[1]),Y.rgb[2](e[2]),r]}function d(e){return parseInt(e,10)}function u(e){return parseFloat(e,10)}function b(e,o,r){return"function"==typeof r?function(i){return i=r(i),i>o?o:e>i?e:i}:function(r){return r>o?o:e>r?e:r}}function p(e){return function(o){return e.test(o)}}function f(e){return'<div id="'+e+'" class="w-colorpicker">    <button class="w-colorpicker_satur_bright"><div></div></button>    <button class="w-colorpicker_hue"><div></div></button>    <div class="w-colorpicker_new_color w-colorpicker_transparent">    <button class="w-colorpicker_color"></button>    </div>    <div class="w-colorpicker_current_color w-colorpicker_transparent">    <button class="w-colorpicker_color"></button>    </div>    <div class="w-colorpicker_field" data-field="hex">    <input id="'+e+'_hex" type="text" maxlength="6" size="6" value=""/>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="rgb.0">    <input id="'+e+'_rgb_0" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="rgb.1">    <input id="'+e+'_rgb_1" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="rgb.2">    <input id="'+e+'_rgb_2" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="hsb.0">    <input id="'+e+'_hsb_0" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="hsb.1">    <input id="'+e+'_hsb_1" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="hsb.2">    <input id="'+e+'_hsb_2" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <button class="w-colorpicker_submit"></button>    </div>'}function h(e,o,r){var i,t,n,c,a=!0;if(Y[o])if(i=Y[o],S(i))for(n=0,c=i.length;c>n;n++)r[n]=i[n](r[n]);else r=i(r);if(M[o]){if(t=M[o],S(t)){for(n=0,c=t.length;c>n;n++)if(!t[n](r[n])){a=!1;break}}else t(r)||(a=!1);a&&(e[o]=r)}return a}function v(e,o,r){var i,t=!1;return null!=r&&(e.opacity=Y.opacity(r),t=!0),o&&(S(o)?(3<o.length&&(r=o[3],o=o.slice(0,3)),h(e,"rgb",o)&&(null!=r&&(e.opacity=Y.opacity(r)),_(e,"rgb"),t=!0)):o.substr&&("rgba"===o.slice(0,4)?(i=l(o,!0),e.rgb=[i[0],i[1],i[2]],e.opacity=Y.opacity(i[3]),_(e,"rgb"),t=!0):"rgb"===o.slice(0,3)?(i=l(o),e.rgb=[i[0],i[1],i[2]],_(e,"rgb"),t=!0):"hsla"===o.slice(0,4)?(i=s(o,!0),e.hsb=[i[0],i[1],i[2]],e.opacity=Y.opacity(i[3]),_(e,"hsb"),t=!0):"hsl"===o.slice(0,3)?(i=s(o),e.hsb=[i[0],i[1],i[2]],_(e,"hsb"),t=!0):h(e,"hex",a(o))&&(_(e,"hex"),t=!0))),t}function g(e,o){return"rgba"===o?"rgba("+e.rgb[0]+","+e.rgb[1]+","+e.rgb[2]+","+e.opacity+")":"rgb"===o?"rgb("+e.rgb[0]+","+e.rgb[1]+","+e.rgb[2]+")":"hsla"===o?"hsla("+e.hsb[0]+","+e.hsb[1]+"%,"+e.hsb[2]+"%,"+e.opacity+")":"hsl"===o?"hsl("+e.hsb[0]+","+e.hsb[1]+"%,"+e.hsb[2]+"%)":"#"+e.hex}function _(e,o){"hsb"===o?(e.rgb=n(e.hsb),e.hex=c(e.rgb)):"rgb"===o?(e.hsb=t(e.rgb),e.hex=c(e.rgb)):"hex"===o&&(e.rgb=i(e.hex),e.hsb=t(e.rgb))}function w(e,o,r){var i="rgba("+e.rgb[0]+","+e.rgb[1]+","+e.rgb[2]+","+e.opacity+")",t="rgb("+n([e.hsb[0],100,100]).join(",")+")";o.hsb[0].val(e.hsb[0]),o.hsb[1].val(e.hsb[1]),o.hsb[2].val(e.hsb[2]),o.rgb[0].val(e.rgb[0]),o.rgb[1].val(e.rgb[1]),o.rgb[2].val(e.rgb[2]),o.hex.val(e.hex),o.hue[0].style.backgroundColor=t,o.indic_sb[0].style.top=150*(100-e.hsb[2])/100+"px",o.indic_sb[0].style.left=150*e.hsb[1]/100+"px",o.indic_hue[0].style.top=148-148*e.hsb[0]/360+"px",o.color_new[0].style.backgroundColor=i,r&&(o.color_current[0].style.backgroundColor=i)}function k(e,o,r,i,t){o&&e.val(i),r&&e.css("background-color",i),e.prop("selectedColor",i),t&&e.trigger(t)}function m(){}function y(e){return E({bindEvent:"click",changeEvent:"colorchange",onShow:m,onBeforeShow:m,onHide:m,format:"rgba",color:"ff0000",opacity:1,livePreview:!0},e||{})}function x(i,t){var n,c,a,s,l,u,b,p,h,m,S,E,z,Y,M,T,j,D,N,W,B=this,I=0,L=0,O=0,X=!1,F=!1;return B instanceof x?(T=function(e){27===e.keyCode&&M(!0)},M=function Q(o){s.hasClass("w-colorpicker-visible")&&(!0===o||o.target!==i[0]&&!r(s[0],o.target,s[0]))&&(!1!==t.onHide(B)&&s.removeClass("w-colorpicker-visible"),e(document).unbind("keyup",T).unbind("mousedown",Q))},Y=function(){if(!s.hasClass("w-colorpicker-visible")){t.onBeforeShow(B);var r=e(this).offset(),i=o(),n=r.top+this.offsetHeight,c=r.left;n+176>i.t+i.h&&(n-=this.offsetHeight+176),c+356>i.l+i.w&&(c-=356),s.css({left:c+"px",top:n+"px"}),!1!==t.onShow(B)&&s.addClass("w-colorpicker-visible"),e(document).bind("keyup",T).bind("mousedown",M)}return!1},l=function(o){if(!I){var r=this,i=e(r.parentNode).addClass("w-colorpicker_slider"),t=i.find("input").focus(),n=i.attr("data-field"),c=n.slice(0,3),a={el:i,field:t,type:n,key:c,index:d(n.slice(-1)),max:"hsb.0"===n?360:"hsb"===c?100:255,val:d(t.val()),y:o.pageY};I=1,e(document).bind("mouseup",a,b).bind("mousemove",a,u)}},u=function(e){var o=e.data.key,r=e.data.index;return j[o][r]=P(0,C(e.data.max,d(e.data.val+e.pageY-e.data.y))),t.livePreview&&(_(j,o),w(j,D)),!1},b=function(o){return e(document).unbind("mouseup",b).unbind("mousemove",u),I=0,_(j,o.data.key),w(j,D),o.data.el.removeClass("w-colorpicker_slider").find("input").focus(),!1},p=function(){if(!L){var o={y:e(this).offset().top};L=1,e(document).bind("mouseup",o,m).bind("mousemove",o,h)}},h=function(e){return j.hsb[0]=A(360*(148-P(0,C(148,e.pageY-e.data.y)))/148),t.livePreview&&(_(j,"hsb"),w(j,D)),!1},m=function(){return e(document).unbind("mouseup",m).unbind("mousemove",h),L=0,_(j,"hsb"),w(j,D),!1},S=function(){if(!O){var o={pos:e(this).offset()};O=1,e(document).bind("mouseup",o,z).bind("mousemove",o,E)}},E=function(e){return j.hsb[1]=A(100*P(0,C(150,e.pageX-e.data.pos.left))/150),j.hsb[2]=A(100*(150-P(0,C(150,e.pageY-e.data.pos.top)))/150),t.livePreview&&(_(j,"hsb"),w(j,D)),!1},z=function(){return e(document).unbind("mouseup",z).unbind("mousemove",E),O=0,_(j,"hsb"),w(j,D),!1},B.dispose=function(){e.removeData(i,"ColorPicker"),B.ui=null,s.remove()},B.setColor=function(e,o){v(j,e,o)&&w(j,D,!0)},B.getColor=function(e){return g(j,e||N)},B.value=function(e,o){return arguments.length?void(v(j,e,o)&&w(j,D,!0)):g(j,N)},t=y(t),a=e(i),e.data(i,"ColorPicker",B),N=a.attr("data-color-format")||t.format||"rgba",W=a.attr("data-color-change")||t.changeEvent,X=a.hasClass("w-colorselector"),F=a.is("input,textarea"),c=t.id||"colorpicker_ui_"+ ++H,s=e(f(c)),j={opacity:1,hsb:[0,0,0],rgb:[0,0,0],hex:"000000"},D={hsb:[s.find("#"+c+"_hsb_0"),s.find("#"+c+"_hsb_1"),s.find("#"+c+"_hsb_2")],rgb:[s.find("#"+c+"_rgb_0"),s.find("#"+c+"_rgb_1"),s.find("#"+c+"_rgb_2")],hex:s.find("#"+c+"_hex"),hue:s.find(".w-colorpicker_satur_bright"),indic_hue:s.find(".w-colorpicker_hue div"),indic_sb:s.find(".w-colorpicker_satur_bright div"),color_new:s.find(".w-colorpicker_new_color > button"),color_current:s.find(".w-colorpicker_current_color > button")},s.on("mousedown",".w-colorpicker_satur_bright",S).on("mousedown",".w-colorpicker_hue",p).on("mousedown","[data-field] > span",l).on("click",".w-colorpicker_new_color,.w-colorpicker_submit",function(){w(j,D,!0),n=j.rgb.slice(),M&&M(!0),k(a,F,X,g(j,N),W)}).on("click",".w-colorpicker_current_color",function(){v(j,n),w(j,D,!0)}),B.ui=s,v(j,a.attr("data-color")||t.color,a.attr("data-opacity")||t.opacity),n=j.rgb.slice(),w(j,D,!0),a.hasClass("w-colorpicker-flat")?s.addClass("w-colorpicker-flat").appendTo(a).show():(s.appendTo(document.body),a.bind(t.bindEvent,Y),k(a,F,X,g(j,N))),a.hasClass("w-colorpicker-light")&&s.addClass("w-colorpicker-light"),a.hasClass("w-colorpicker-dark")&&s.addClass("w-colorpicker-dark"),a.hasClass("w-colorpicker-transition-fade")&&s.addClass("w-colorpicker-transition-fade"),void(a.hasClass("w-colorpicker-transition-slide")&&s.addClass("w-colorpicker-transition-slide"))):new x(i,t)}var C=Math.min,P=Math.max,A=Math.round,S=e.isArray,E=e.extend,z=/\s*,\s*/g,H=0,Y={opacity:b(0,1,u),hsb:[b(0,360,d),b(0,100,d),b(0,100,d)],rgb:[b(0,255,d),b(0,255,d),b(0,255,d)]},M={hex:p(/^[0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f]$/i)};e.ColorPicker=x,e.fn.ColorPicker=function(o){var r=arguments,i=this;return this.each(function(){var t=this,n=e.data(t,"ColorPicker");if(n){if("dispose"===o)n.dispose();else if("value"===o){if(!(r.length>1))return i=n.value(),!1;n.value(r[1])}}else new x(t,o)}),i}}(jQuery);