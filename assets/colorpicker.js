/**
*
* Color Picker Widget
* https://github.com/foo123/colorpicker
* adapted from: http://www.eyecon.ro/colorpicker/
*      Color Picker by Stefan Petre www.eyecon.ro (MIT and GPL)
*/
!function(e,o,r){"use strict";"object"==typeof exports?module.exports=r():"function"==typeof define&&define.amd?define(function(){return r()}):e[o]=r()}(this,"ColorPicker",function(){"use strict";function e(){var e="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}}function o(e,o,r){if(e===o)return!0;if(e.contains)return e.contains(o);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(o));for(var i=o.parentNode;i&&i!==r;){if(i===e)return!0;i=i.parentNode}return!1}function r(e){return e=parseInt(e,16),[e>>16&255,e>>8&255,255&e]}function i(e){var o=0,r=0,i=0,t=e[0],n=e[1],c=e[2],s=x(t,n,c),a=C(t,n,c),l=a-s;return i=a,r=0!=a?255*l/a:0,o=0!=r?t===a?(n-c)/l:n===a?2+(c-t)/l:4+(t-n)/l:-1,o*=60,0>o&&(o+=360),r*=100/255,i*=100/255,[P(o),P(r),P(i)]}function t(e){var o,r,i,t=P(e[0]),n=P(255*e[1]/100),c=P(255*e[2]/100);if(0===n)o=r=i=c;else{var s=c,a=(255-n)*c/255,l=(s-a)*(t%60)/60;360==t&&(t=0),60>t?(o=s,i=a,r=a+l):120>t?(r=s,i=a,o=s-l):180>t?(r=s,o=a,i=a+l):240>t?(i=s,o=a,r=s-l):300>t?(i=s,r=a,o=a+l):360>t?(o=s,r=a,i=s-l):(o=0,r=0,i=0)}return[P(o),P(r),P(i)]}function n(e){var o=[e[0].toString(16),e[1].toString(16),e[2].toString(16)];return 1===o[0].length&&(o[0]="0"+o[0]),1===o[1].length&&(o[1]="0"+o[1]),1===o[2].length&&(o[2]="0"+o[2]),o[0]+o[1]+o[2]}function c(e){e="#"===e.charAt(0)?e.slice(1):e;var o=6-e.length;return o>0&&(e=3===o?e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2):new Array(o+1).join("0")+e),e}function s(e,o){e.substr&&(e=e.slice(o?5:4,-1).split(E));var r=o?Y.opacity(e[3]):null;return[Y.hsb[0](e[0]),Y.hsb[1](e[1]),Y.hsb[2](e[2]),r]}function a(e,o){e.substr&&(e=e.slice(o?5:4,-1).split(E));var r=o?Y.opacity(e[3]):null;return[Y.rgb[0](e[0]),Y.rgb[1](e[1]),Y.rgb[2](e[2]),r]}function l(e){return parseInt(e,10)}function d(e){return parseFloat(e,10)}function u(e,o,r){return"function"==typeof r?function(i){return i=r(i),i>o?o:e>i?e:i}:function(r){return r>o?o:e>r?e:r}}function b(e){return function(o){return e.test(o)}}function p(e){return'<div id="'+e+'" class="w-colorpicker">    <button class="w-colorpicker_satur_bright"><div></div></button>    <button class="w-colorpicker_hue"><div></div></button>    <div class="w-colorpicker_new_color w-colorpicker_transparent">    <button class="w-colorpicker_color"></button>    </div>    <div class="w-colorpicker_current_color w-colorpicker_transparent">    <button class="w-colorpicker_color"></button>    </div>    <div class="w-colorpicker_field" data-field="hex">    <input id="'+e+'_hex" type="text" maxlength="6" size="6" value=""/>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="rgb.0">    <input id="'+e+'_rgb_0" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="rgb.1">    <input id="'+e+'_rgb_1" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="rgb.2">    <input id="'+e+'_rgb_2" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="hsb.0">    <input id="'+e+'_hsb_0" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="hsb.1">    <input id="'+e+'_hsb_1" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="hsb.2">    <input id="'+e+'_hsb_2" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <button class="w-colorpicker_submit"></button>    </div>'}function f(e,o,r){var i,t,n,c,s=!0;if(Y[o])if(i=Y[o],A(i))for(n=0,c=i.length;c>n;n++)r[n]=i[n](r[n]);else r=i(r);if(j[o]){if(t=j[o],A(t)){for(n=0,c=t.length;c>n;n++)if(!t[n](r[n])){s=!1;break}}else t(r)||(s=!1);s&&(e[o]=r)}return s}function h(e,o,r){var i,t=!1;return null!=r&&(e.opacity=Y.opacity(r),t=!0),o&&(A(o)?(3<o.length&&(r=o[3],o=o.slice(0,3)),f(e,"rgb",o)&&(null!=r&&(e.opacity=Y.opacity(r)),g(e,"rgb"),t=!0)):o.substr&&("rgba"===o.slice(0,4)?(i=a(o,!0),e.rgb=[i[0],i[1],i[2]],e.opacity=Y.opacity(i[3]),g(e,"rgb"),t=!0):"rgb"===o.slice(0,3)?(i=a(o),e.rgb=[i[0],i[1],i[2]],g(e,"rgb"),t=!0):"hsla"===o.slice(0,4)?(i=s(o,!0),e.hsb=[i[0],i[1],i[2]],e.opacity=Y.opacity(i[3]),g(e,"hsb"),t=!0):"hsl"===o.slice(0,3)?(i=s(o),e.hsb=[i[0],i[1],i[2]],g(e,"hsb"),t=!0):f(e,"hex",c(o))&&(g(e,"hex"),t=!0))),t}function v(e,o){return"rgba"===o?"rgba("+e.rgb[0]+","+e.rgb[1]+","+e.rgb[2]+","+e.opacity+")":"rgb"===o?"rgb("+e.rgb[0]+","+e.rgb[1]+","+e.rgb[2]+")":"hsla"===o?"hsla("+e.hsb[0]+","+e.hsb[1]+"%,"+e.hsb[2]+"%,"+e.opacity+")":"hsl"===o?"hsl("+e.hsb[0]+","+e.hsb[1]+"%,"+e.hsb[2]+"%)":"#"+e.hex}function g(e,o){"hsb"===o?(e.rgb=t(e.hsb),e.hex=n(e.rgb)):"rgb"===o?(e.hsb=i(e.rgb),e.hex=n(e.rgb)):"hex"===o&&(e.rgb=r(e.hex),e.hsb=i(e.rgb))}function _(e,o,r){var i="rgba("+e.rgb[0]+","+e.rgb[1]+","+e.rgb[2]+","+e.opacity+")",n="rgb("+t([e.hsb[0],100,100]).join(",")+")";o.hsb[0].val(e.hsb[0]),o.hsb[1].val(e.hsb[1]),o.hsb[2].val(e.hsb[2]),o.rgb[0].val(e.rgb[0]),o.rgb[1].val(e.rgb[1]),o.rgb[2].val(e.rgb[2]),o.hex.val(e.hex),o.hue[0].style.backgroundColor=n,o.indic_sb[0].style.top=150*(100-e.hsb[2])/100+"px",o.indic_sb[0].style.left=150*e.hsb[1]/100+"px",o.indic_hue[0].style.top=148-148*e.hsb[0]/360+"px",o.color_new[0].style.backgroundColor=i,r&&(o.color_current[0].style.backgroundColor=i)}function w(e,o,r,i,t){o&&e.val(i),r&&e.css("background-color",i),e.prop("selectedColor",i),t&&e.trigger(t)}function k(){}function m(e){return S({bindEvent:"click",changeEvent:"colorchange",onShow:k,onBeforeShow:k,onHide:k,format:"rgba",color:"ff0000",opacity:1,livePreview:!0},e||{})}function y(r,i){var t,n,c,s,a,d,u,b,f,k,A,S,E,Y,j,M,T,D,N,W,B=this,I=0,L=0,O=0,X=!1,F=!1;return B instanceof y?(M=function(e){27===e.keyCode&&j(!0)},j=function Q(e){s.hasClass("w-colorpicker-visible")&&(!0===e||e.target!==r[0]&&!o(s[0],e.target,s[0]))&&(!1!==i.onHide(B)&&s.removeClass("w-colorpicker-visible"),H(document).unbind("keyup",M).unbind("mousedown",Q))},Y=function(){if(!s.hasClass("w-colorpicker-visible")){i.onBeforeShow(B);var o=H(this).offset(),r=e(),t=o.top+this.offsetHeight,n=o.left;t+176>r.t+r.h&&(t-=this.offsetHeight+176),n+356>r.l+r.w&&(n-=356),s.css({left:n+"px",top:t+"px"}),!1!==i.onShow(B)&&s.addClass("w-colorpicker-visible"),H(document).bind("keyup",M).bind("mousedown",j)}return!1},a=function(e){if(!I){var o=this,r=H(o.parentNode).addClass("w-colorpicker_slider"),i=r.find("input").focus(),t=r.attr("data-field"),n=t.slice(0,3),c={el:r,field:i,type:t,key:n,index:l(t.slice(-1)),max:"hsb.0"===t?360:"hsb"===n?100:255,val:l(i.val()),y:e.pageY};I=1,H(document).bind("mouseup",c,u).bind("mousemove",c,d)}},d=function(e){var o=e.data.key,r=e.data.index;return T[o][r]=C(0,x(e.data.max,l(e.data.val+e.pageY-e.data.y))),i.livePreview&&(g(T,o),_(T,D)),!1},u=function(e){return H(document).unbind("mouseup",u).unbind("mousemove",d),I=0,g(T,e.data.key),_(T,D),e.data.el.removeClass("w-colorpicker_slider").find("input").focus(),!1},b=function(){if(!L){var e={y:H(this).offset().top};L=1,H(document).bind("mouseup",e,k).bind("mousemove",e,f)}},f=function(e){return T.hsb[0]=P(360*(148-C(0,x(148,e.pageY-e.data.y)))/148),i.livePreview&&(g(T,"hsb"),_(T,D)),!1},k=function(){return H(document).unbind("mouseup",k).unbind("mousemove",f),L=0,g(T,"hsb"),_(T,D),!1},A=function(){if(!O){var e={pos:H(this).offset()};O=1,H(document).bind("mouseup",e,E).bind("mousemove",e,S)}},S=function(e){return T.hsb[1]=P(100*C(0,x(150,e.pageX-e.data.pos.left))/150),T.hsb[2]=P(100*(150-C(0,x(150,e.pageY-e.data.pos.top)))/150),i.livePreview&&(g(T,"hsb"),_(T,D)),!1},E=function(){return H(document).unbind("mouseup",E).unbind("mousemove",S),O=0,g(T,"hsb"),_(T,D),!1},B.dispose=function(){H.removeData(r,"ColorPicker"),B.ui=null,s.remove()},B.setColor=function(e,o){h(T,e,o)&&_(T,D,!0)},B.getColor=function(e){return v(T,e||N)},B.value=function(e,o){return arguments.length?void(h(T,e,o)&&_(T,D,!0)):v(T,N)},i=m(i),c=H(r),H.data(r,"ColorPicker",B),N=c.attr("data-color-format")||i.format||"rgba",W=c.attr("data-color-change")||i.changeEvent,X=c.hasClass("w-colorselector"),F=c.is("input,textarea"),n=i.id||"colorpicker_ui_"+ ++z,s=H(p(n)),T={opacity:1,hsb:[0,0,0],rgb:[0,0,0],hex:"000000"},D={hsb:[s.find("#"+n+"_hsb_0"),s.find("#"+n+"_hsb_1"),s.find("#"+n+"_hsb_2")],rgb:[s.find("#"+n+"_rgb_0"),s.find("#"+n+"_rgb_1"),s.find("#"+n+"_rgb_2")],hex:s.find("#"+n+"_hex"),hue:s.find(".w-colorpicker_satur_bright"),indic_hue:s.find(".w-colorpicker_hue div"),indic_sb:s.find(".w-colorpicker_satur_bright div"),color_new:s.find(".w-colorpicker_new_color > button"),color_current:s.find(".w-colorpicker_current_color > button")},s.on("mousedown",".w-colorpicker_satur_bright",A).on("mousedown",".w-colorpicker_hue",b).on("mousedown","[data-field] > span",a).on("click",".w-colorpicker_new_color,.w-colorpicker_submit",function(){_(T,D,!0),t=T.rgb.slice(),j&&j(!0),w(c,F,X,v(T,N),W)}).on("click",".w-colorpicker_current_color",function(){h(T,t),_(T,D,!0)}),B.ui=s,h(T,c.attr("data-color")||i.color,c.attr("data-opacity")||i.opacity),t=T.rgb.slice(),_(T,D,!0),c.hasClass("w-colorpicker-flat")?s.addClass("w-colorpicker-flat").appendTo(c).show():(s.appendTo(document.body),c.bind(i.bindEvent,Y),w(c,F,X,v(T,N))),c.hasClass("w-colorpicker-light")&&s.addClass("w-colorpicker-light"),c.hasClass("w-colorpicker-dark")&&s.addClass("w-colorpicker-dark"),c.hasClass("w-colorpicker-transition-fade")&&s.addClass("w-colorpicker-transition-fade"),void(c.hasClass("w-colorpicker-transition-slide")&&s.addClass("w-colorpicker-transition-slide"))):new y(r,i)}var x=Math.min,C=Math.max,P=Math.round,A=H.isArray,S=H.extend,E=/\s*,\s*/g,z=0,H=jQuery,Y={opacity:u(0,1,d),hsb:[u(0,360,l),u(0,100,l),u(0,100,l)],rgb:[u(0,255,l),u(0,255,l),u(0,255,l)]},j={hex:b(/^[0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f]$/i)};return H.ColorPicker=y,H.fn.ColorPicker=function(e){var o=arguments,r=this;return this.each(function(){var i=this,t=H.data(i,"ColorPicker");if(t){if("dispose"===e)t.dispose();else if("value"===e){if(!(o.length>1))return r=t.value(),!1;t.value(o[1])}}else new y(i,e)}),r},y});