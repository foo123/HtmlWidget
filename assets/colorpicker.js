/**
*
* Color Picker Widget
* https://github.com/foo123/colorpicker
* adapted from: http://www.eyecon.ro/colorpicker/
*      Color Picker by Stefan Petre www.eyecon.ro (MIT and GPL)
*/
!function(e,o,i){"use strict";"object"==typeof exports?module.exports=i():"function"==typeof define&&define.amd?define(function(){return i()}):e[o]=i()}(this,"ColorPicker",function(){"use strict";function e(){var e="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}}function o(e,o,i){if(e===o)return!0;if(e.contains)return e.contains(o);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(o));for(var t=o.parentNode;t&&t!==i;){if(t===e)return!0;t=t.parentNode}return!1}function i(e){return e=parseInt(e,16),[e>>16&255,e>>8&255,255&e]}function t(e){var o=0,i=0,t=0,r=e[0],n=e[1],c=e[2],a=x(r,n,c),s=C(r,n,c),l=s-a;return t=s,i=0!=s?255*l/s:0,o=0!=i?r===s?(n-c)/l:n===s?2+(c-r)/l:4+(r-n)/l:-1,o*=60,0>o&&(o+=360),i*=100/255,t*=100/255,[P(o),P(i),P(t)]}function r(e){var o,i,t,r=P(e[0]),n=P(255*e[1]/100),c=P(255*e[2]/100);if(0===n)o=i=t=c;else{var a=c,s=(255-n)*c/255,l=(a-s)*(r%60)/60;360==r&&(r=0),60>r?(o=a,t=s,i=s+l):120>r?(i=a,t=s,o=a-l):180>r?(i=a,o=s,t=s+l):240>r?(t=a,o=s,i=a-l):300>r?(t=a,i=s,o=s+l):360>r?(o=a,i=s,t=a-l):(o=0,i=0,t=0)}return[P(o),P(i),P(t)]}function n(e){var o=[e[0].toString(16),e[1].toString(16),e[2].toString(16)];return 1===o[0].length&&(o[0]="0"+o[0]),1===o[1].length&&(o[1]="0"+o[1]),1===o[2].length&&(o[2]="0"+o[2]),o[0]+o[1]+o[2]}function c(e){e="#"===e.charAt(0)?e.slice(1):e;var o=6-e.length;return o>0&&(e=3===o?e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2):new Array(o+1).join("0")+e),e}function a(e,o){e.substr&&(e=e.slice(o?5:4,-1).split(E));var i=o?Y.opacity(e[3]):null;return[Y.hsb[0](e[0]),Y.hsb[1](e[1]),Y.hsb[2](e[2]),i]}function s(e,o){e.substr&&(e=e.slice(o?5:4,-1).split(E));var i=o?Y.opacity(e[3]):null;return[Y.rgb[0](e[0]),Y.rgb[1](e[1]),Y.rgb[2](e[2]),i]}function l(e){return parseInt(e,10)}function d(e){return parseFloat(e,10)}function u(e,o,i){return"function"==typeof i?function(t){return t=i(t),t>o?o:e>t?e:t}:function(i){return i>o?o:e>i?e:i}}function p(e){return function(o){return e.test(o)}}function b(e){return'<div id="'+e+'" class="w-colorpicker">    <button class="w-colorpicker_satur_bright"><div></div></button>    <button class="w-colorpicker_hue"><div></div></button>    <div class="w-colorpicker_new_color w-colorpicker_transparent">    <button class="w-colorpicker_color"></button>    </div>    <div class="w-colorpicker_current_color w-colorpicker_transparent">    <button class="w-colorpicker_color"></button>    </div>    <div class="w-colorpicker_field" data-field="hex">    <input id="'+e+'_hex" type="text" maxlength="6" size="6" value=""/>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="rgb.0">    <input id="'+e+'_rgb_0" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="rgb.1">    <input id="'+e+'_rgb_1" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="rgb.2">    <input id="'+e+'_rgb_2" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="hsb.0">    <input id="'+e+'_hsb_0" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="hsb.1">    <input id="'+e+'_hsb_1" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <div class="w-colorpicker_field" data-field="hsb.2">    <input id="'+e+'_hsb_2" type="text" maxlength="3" size="3" value=""/><span></span>    <div class="w-colorpicker_field_back"></div>    </div>    <button class="w-colorpicker_submit"></button>    </div>'}function f(e,o,i){var t,r,n,c,a=!0;if(Y[o])if(t=Y[o],A(t))for(n=0,c=t.length;c>n;n++)i[n]=t[n](i[n]);else i=t(i);if(j[o]){if(r=j[o],A(r)){for(n=0,c=r.length;c>n;n++)if(!r[n](i[n])){a=!1;break}}else r(i)||(a=!1);a&&(e[o]=i)}return a}function h(e,o,i){var t,r=!1;return null!=i&&(e.opacity=Y.opacity(i),r=!0),o&&(A(o)?(3<o.length&&(i=o[3],o=o.slice(0,3)),f(e,"rgb",o)&&(null!=i&&(e.opacity=Y.opacity(i)),g(e,"rgb"),r=!0)):o.substr&&("rgba"===o.slice(0,4)?(t=s(o,!0),e.rgb=[t[0],t[1],t[2]],e.opacity=Y.opacity(t[3]),g(e,"rgb"),r=!0):"rgb"===o.slice(0,3)?(t=s(o),e.rgb=[t[0],t[1],t[2]],g(e,"rgb"),r=!0):"hsla"===o.slice(0,4)?(t=a(o,!0),e.hsb=[t[0],t[1],t[2]],e.opacity=Y.opacity(t[3]),g(e,"hsb"),r=!0):"hsl"===o.slice(0,3)?(t=a(o),e.hsb=[t[0],t[1],t[2]],g(e,"hsb"),r=!0):f(e,"hex",c(o))&&(g(e,"hex"),r=!0))),r}function v(e,o){return"rgba"===o?"rgba("+e.rgb[0]+","+e.rgb[1]+","+e.rgb[2]+","+e.opacity+")":"rgb"===o?"rgb("+e.rgb[0]+","+e.rgb[1]+","+e.rgb[2]+")":"hsla"===o?"hsla("+e.hsb[0]+","+e.hsb[1]+"%,"+e.hsb[2]+"%,"+e.opacity+")":"hsl"===o?"hsl("+e.hsb[0]+","+e.hsb[1]+"%,"+e.hsb[2]+"%)":"#"+e.hex}function g(e,o){"hsb"===o?(e.rgb=r(e.hsb),e.hex=n(e.rgb)):"rgb"===o?(e.hsb=t(e.rgb),e.hex=n(e.rgb)):"hex"===o&&(e.rgb=i(e.hex),e.hsb=t(e.rgb))}function _(e,o,i){var t=e.rgb,n=e.hsb,c=e.opacity,a="rgba("+t[0]+","+t[1]+","+t[2]+","+c+")",s="rgb("+r([n[0],100,100]).join(",")+")";o.hsb[0].val(n[0]),o.hsb[1].val(n[1]),o.hsb[2].val(n[2]),o.rgb[0].val(t[0]),o.rgb[1].val(t[1]),o.rgb[2].val(t[2]),o.hex.val(e.hex),o.hue[0].style.backgroundColor=s,o.indic_sb[0].style.top=150*(100-n[2])/100+"px",o.indic_sb[0].style.left=150*n[1]/100+"px",o.indic_hue[0].style.top=148-148*n[0]/360+"px",o.color_new[0].style.backgroundColor=a,i&&(o.color_current[0].style.backgroundColor=a)}function w(e,o,i,t,r){o&&e.val(t),i&&e.css("background-color",t),e.prop("selectedColor",t),r&&e.trigger(r)}function k(){}function m(e){return S({bindEvent:"click",changeEvent:"colorchange",onShow:k,onBeforeShow:k,onHide:k,format:"rgba",color:"ff0000",opacity:1,livePreview:!0},e||{})}function y(i,t){var r,n,c,a,s,d,u,p,f,k,A,S,E,Y,j,M,T,D,N,W,B=this,I=0,L=0,O=0,X=!1,F=!1;return B instanceof y?(M=function(e){27===e.keyCode&&j(!0)},j=function Q(e){a.hasClass("w-colorpicker-visible")&&(!0===e||e.target!==i[0]&&!o(a[0],e.target,a[0]))&&(!1!==t.onHide(B)&&a.removeClass("w-colorpicker-visible"),H(document).unbind("keyup",M).unbind("mousedown",Q))},Y=function(){if(!a.hasClass("w-colorpicker-visible")){t.onBeforeShow(B);var o=H(this).offset(),i=e(),r=o.top+this.offsetHeight,n=o.left;r+176>i.t+i.h&&(r-=this.offsetHeight+176),n+356>i.l+i.w&&(n-=356),a.css({left:n+"px",top:r+"px"}),!1!==t.onShow(B)&&a.addClass("w-colorpicker-visible"),H(document).bind("keyup",M).bind("mousedown",j)}return!1},s=function(e){if(!I){var o=this,i=H(o.parentNode).addClass("w-colorpicker_slider"),t=i.find("input").focus(),r=i.attr("data-field"),n=r.slice(0,3),c={el:i,field:t,type:r,key:n,index:l(r.slice(-1)),max:"hsb.0"===r?360:"hsb"===n?100:255,val:l(t.val()),y:e.pageY};I=1,H(document).bind("mouseup",c,u).bind("mousemove",c,d)}},d=function(e){var o=e.data.key,i=e.data.index;return T[o][i]=C(0,x(e.data.max,l(e.data.val+e.pageY-e.data.y))),t.livePreview&&(g(T,o),_(T,D)),!1},u=function(e){return H(document).unbind("mouseup",u).unbind("mousemove",d),I=0,g(T,e.data.key),_(T,D),e.data.el.removeClass("w-colorpicker_slider").find("input").focus(),!1},p=function(){if(!L){var e={y:H(this).offset().top};L=1,H(document).bind("mouseup",e,k).bind("mousemove",e,f)}},f=function(e){return T.hsb[0]=P(360*(148-C(0,x(148,e.pageY-e.data.y)))/148),t.livePreview&&(g(T,"hsb"),_(T,D)),!1},k=function(){return H(document).unbind("mouseup",k).unbind("mousemove",f),L=0,g(T,"hsb"),_(T,D),!1},A=function(){if(!O){var e={pos:H(this).offset()};O=1,H(document).bind("mouseup",e,E).bind("mousemove",e,S)}},S=function(e){return T.hsb[1]=P(100*C(0,x(150,e.pageX-e.data.pos.left))/150),T.hsb[2]=P(100*(150-C(0,x(150,e.pageY-e.data.pos.top)))/150),t.livePreview&&(g(T,"hsb"),_(T,D)),!1},E=function(){return H(document).unbind("mouseup",E).unbind("mousemove",S),O=0,g(T,"hsb"),_(T,D),!1},B.dispose=function(){H.removeData(i,"ColorPicker"),B.ui=null,a.remove()},B.setColor=function(e,o){h(T,e,o)&&_(T,D,!0)},B.getColor=function(e){return v(T,e||N)},B.value=function(e,o){return arguments.length?void(h(T,e,o)&&_(T,D,!0)):v(T,N)},t=m(t),c=H(i),H.data(i,"ColorPicker",B),N=c.attr("data-color-format")||t.format||"rgba",W=c.attr("data-color-change")||t.changeEvent,X=c.hasClass("w-colorselector"),F=c.is("input,textarea"),n=t.id||"colorpicker_ui_"+ ++z,a=H(b(n)),T={opacity:1,hsb:[0,0,0],rgb:[0,0,0],hex:"000000"},D={hsb:[a.find("#"+n+"_hsb_0"),a.find("#"+n+"_hsb_1"),a.find("#"+n+"_hsb_2")],rgb:[a.find("#"+n+"_rgb_0"),a.find("#"+n+"_rgb_1"),a.find("#"+n+"_rgb_2")],hex:a.find("#"+n+"_hex"),hue:a.find(".w-colorpicker_satur_bright"),indic_hue:a.find(".w-colorpicker_hue div"),indic_sb:a.find(".w-colorpicker_satur_bright div"),color_new:a.find(".w-colorpicker_new_color > button"),color_current:a.find(".w-colorpicker_current_color > button")},a.on("mousedown",".w-colorpicker_satur_bright",A).on("mousedown",".w-colorpicker_hue",p).on("mousedown","[data-field] > span",s).on("click",".w-colorpicker_new_color,.w-colorpicker_submit",function(){_(T,D,!0),r=T.rgb.slice(),j&&j(!0),w(c,F,X,v(T,N),W)}).on("click",".w-colorpicker_current_color",function(){h(T,r),_(T,D,!0)}),B.ui=a,h(T,c.attr("data-color")||t.color,c.attr("data-opacity")||t.opacity),r=T.rgb.slice(),_(T,D,!0),c.hasClass("w-colorpicker-flat")?a.addClass("w-colorpicker-flat").appendTo(c).show():(a.appendTo(document.body),c.bind(t.bindEvent,Y),w(c,F,X,v(T,N))),c.hasClass("w-colorpicker-light")&&a.addClass("w-colorpicker-light"),c.hasClass("w-colorpicker-dark")&&a.addClass("w-colorpicker-dark"),c.hasClass("w-colorpicker-transition-fade")&&a.addClass("w-colorpicker-transition-fade"),void(c.hasClass("w-colorpicker-transition-slide")&&a.addClass("w-colorpicker-transition-slide"))):new y(i,t)}var x=Math.min,C=Math.max,P=Math.round,A=H.isArray,S=H.extend,E=/\s*,\s*/g,z=0,H=jQuery,Y={opacity:u(0,1,d),hsb:[u(0,360,l),u(0,100,l),u(0,100,l)],rgb:[u(0,255,l),u(0,255,l),u(0,255,l)]},j={hex:p(/^[0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f]$/i)};return H.ColorPicker=y,H.fn.ColorPicker=function(e){var o=arguments,i=this;return this.each(function(){var t=this,r=H.data(t,"ColorPicker");if(r){if("dispose"===e)r.dispose();else if("value"===e){if(!(o.length>1))return i=r.value(),!1;r.value(o[1])}}else new y(t,e)}),i},y});