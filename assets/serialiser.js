/**
*  Serialiser.js
*  Parse, serialise and url-encode/decode complex form fields to/from an object model / FormData
*
*  @version: 0.5.0
*  https://github.com/foo123/serialiser.js
*
**/
!function(e,n,t){"use strict";"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(function(){return t()}):e[n]=t()}(this,"Serialiser",function(e){"use strict";function t(e,n){if("function"==typeof e)return e;if(n){var t=J("^"+V(n)+"([\\.\\[].+)$");return function(n){var r,o=n[w](e);return o&&(r=o.match(t))?r[1]:null}}return function(n){return n[w](e)}}function r(n,t){return"function"==typeof n?n:!1!==t?function(t){var r=t[T]("data-alt-value")?t[w]("data-alt-value"):null,o=("value"===n?B(t):t[w](n))||"",i=(t[w]("type")||t[L]||"").toLowerCase();return"file"===i?r&&null!=t[r]&&t[r].length?t[r]:t.files&&t.files.length?t.files:null:("checkbox"!==i&&"radio"!==i||t[F])&&("select"!==i||o.length&&-1!==t[M])&&("text"!==i&&"textarea"!==i||X(o).length)?o:e}:function(t){var r=t[T]("data-alt-value")?t[w]("data-alt-value"):null,o=("value"===n?B(t):t[w](n))||"",i=(t[w]("type")||t[L]).toLowerCase();return"file"===i?r&&null!=t[r]&&t[r].length?t[r]:t.files&&t.files.length?t.files:null:"checkbox"!==i&&"radio"!==i||t[F]?o:e}}function o(e,n,o,i,u,l){n=n||{},o=t(o||"name"),i=r(i||"value"),arguments.length<5&&(u=!1),l=!0===l;for(var a=0,f=e.length;f>a;a++){var c,s,d,h,p,g,v=e[a],y=!1,C=u?!!v[w](u):!1;if(c=o(v),c&&(s=i(v),null!=s)){C&&(s=s?b(s):null);var y=W.test(c);for(d=q(c).split("."),p=n;d.length;)if(h=d.shift(),d.length){if(p[A](h))!l&&K.test(d[0])&&p[h].length<=(g=parseInt(d[0],10))&&(p[h]=p[h].concat(new Array(g-p[h].length+1)));else if(y&&1===d.length){if(s instanceof FileList){p[h]=s;break}p[h]=[]}else p[h]=!l&&K.test(d[0])?new Array(parseInt(d[0],10)+1):{};p=p[h]}else y?p.push(s):p[h]=s}}return n}function u(e,n){var t,r,o,i,u,l,a,f;for("data:"===e.substr(0,5)?(-1<(f=e.indexOf(";base64,"))?(o=e.slice(5,f),e=e.slice(f+8),t=m(e)):(o=e.slice(5,f=e.indexOf(",")),e=e.slice(f+1),t=unescape(e)),null==n&&(n=o)):t=e,l=t.length,r=new Uint8Array(l),u=15&l,i=0;u>i;i++)r[i]=255&t.charCodeAt(i);for(i=u;l>i;i+=16)a=i,r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++),r[a]=255&t.charCodeAt(a++);return new Blob([r],{type:n})}function a(e,t,r,o){t=t||{},r=!!r,o=!0===o;var u,a,f,c,s,d,h={"true":!0,"false":!1,"null":null,undefined:void 0};for(u=e.replace(/%20|\+/g," ").split("&"),i=0,l=u.length;l>i;i++){a=u[i].split("="),f=S(a[0]),c=a.length>1?S(a[1]):r?void 0:"",r&&(c=c&&!isNaN(c)&&+c+""===c?+c:"undefined"==typeof c?void 0:h[A][c]?h[c]:c);var p=W.test(f);for(f=q(f).split("."),s=t;f.length;)d=f.shift(),f.length?(s[A](d)?!o&&K.test(f[0])&&s[d].length<=(n=parseInt(f[0],10))&&(s[d]=s[d].concat(new Array(n-s[d].length+1))):s[d]=p&&1===f.length?[]:!o&&K.test(f[0])?new Array(parseInt(f[0],10)+1):{},s=s[d]):p?s.push(c):s[d]=c}return t}function f(e,n,t,r){var o,i,u;if(r)if(z(n))if(W.test(r))for(i=0,u=n.length;u>i;i++)t(e,r,n[i]);else for(i=0,u=n.length;u>i;i++)f(e,n[i],t,r+"["+("object"==typeof n[i]?i:"")+"]");else if(n instanceof FileList)for(i=0,u=n.length;u>i;i++)t(e,r,n[i]);else if(n instanceof File||n instanceof Blob)t(e,r,n);else if(n&&"object"==typeof n)for(o in n)n[A](o)&&f(e,n[o],t,r+"["+o+"]");else t(e,r,n);else if(z(n))for(i=0,u=n.length;u>i;i++)t(e,n[i].name,n[i].value);else if(n instanceof FileList)for(i=0,u=n.length;u>i;i++)t(e,r,n[i]);else if(n instanceof File||n instanceof Blob)t(e,r,n);else if(n&&"object"==typeof n)for(o in n)n[A](o)&&f(e,n[o],t,o);return e}function c(e,n,t){"function"==typeof t&&(t=t()),e.push(I(n)+"="+I(null==t?"":t))}function s(e,n,t){var r=f(n||[],e||{},c);return!0!==t&&(r=r.join("&").split("%20").join("+")),r}function d(e,n,t){if("function"==typeof t&&(t=t()),t instanceof FileList)for(var r=0,o=t.length;o>r;r++)e.append(n,t[r],t[r].name);else t instanceof File?e.append(n,t,t.name):e.append(n,null==t?"":t)}function h(e,n,t){return null==t&&"undefined"!=typeof FormData&&(t=FormData),t&&e instanceof t?e:f(n||new t,e||{},d)}function p(e){return C(e||{})}function g(){return!0}function v(){return!1}var A="hasOwnProperty",y=Object.prototype.toString,C=JSON.stringify,b=JSON.parse,m=atob,I=encodeURIComponent,S=decodeURIComponent,w="getAttribute",T="hasAttribute",F="checked",E="disabled",x="selected",L="tagName",O="type",j="value",N="options",M="selectedIndex",R="parentNode",U="innerText",D="textContent",$=function(e){var n=e.attributes[j];return!n||n.specified?e[j]:e.text},k=function(e){for(var n,t,r=e[N],o=e[M],i="select-one"===e[O]||0>o,u=i?null:[],l=i?o+1:r.length,a=0>o?l:i?o:0;l>a;a++)if(t=r[a],!(!t[x]&&a!==o||t[E]||t[R][E]&&"optgroup"===t[R][L].toLowerCase())){if(n=$(t),i)return n;u.push(n)}return u},B=function(e){if(e){var n=null;switch(e[T]("data-alt-value")&&(n=e[w]("data-alt-value")),e[L].toLowerCase()){case"input":return"file"===e.type.toLowerCase()?n&&null!=e[n]&&e[n].length?e[n]:e.files.length?e.files:null:n&&null!=e[n]?e[n]:e[j];case"textarea":return n&&null!=e[n]?e[n]:e[j];case"select":return n&&null!=e[n]?e[n]:k(e);default:return n&&null!=e[n]?e[n]:D in e?e[D]:e[U]}}},P=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,V=function(e){return e.replace(P,"\\$&")},J=function(e,n){return new RegExp(e,n||"")},H=/^\s+|\s+$/g,X=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(H,"")},K=/^\d+$/,Q=/\[([^\]]*)\]/g,W=/\[\s*\]$/,_=/^\.+/g,q=function(e){return e.replace(Q,".$1").replace(_,"")},z=function(e){return"[object Array]"===y.call(e)};return{VERSION:"0.5.0",Type:{COMPOSITE:function(){var e=arguments;return e[0]&&e[0].concat&&(e=e[0]),function(n,t,r,o,i){for(var u=e.length;u--;)n=e[u](n,t,r,o,i);return n}},DEFAULT:function(e){return function(n){return(null==n||"[object String]"===y.call(n)&&!X(n).length)&&(n=e),n}},BOOL:function(e){if("[object String]"===y.call(e)&&e.length){var n=e.toLowerCase();return"true"===n||"on"===n||"yes"===n||"1"===n}return!!e},INT:function(e){return parseInt(e||0,10)||0},FLOAT:function(e){return parseFloat(e||0,10)||0},STR:function(e){return String(e)},MIN:function(e){return function(n){return e>n?e:n}},MAX:function(e){return function(n){return n>e?e:n}},CLAMP:function(e,n){if(e>n){var t=n;n=e,e=t}return function(t){return e>t?e:t>n?n:t}}},Validator:{PASS:g,FAIL:v,NOT:function(e){return function(n,t,r,o,i){return!e(n,t,r,o,i)}},AND:function(e,n){return function(t,r,o,i,u){return e(t,r,o,i,u)&&n(t,r,o,i,u)}},EITHER:function(e,n){return function(t,r,o,i,u){return e(t,r,o,i,u)||n(t,r,o,i,u)}},IIF:function(e,n,t){return t=t||g,function(r,o,i,u,l){return e(r,o,i,u,l)?n(r,o,i,u,l):t(r,o,i,u,l)}},REQUIRED:function(e){var n=y.call(e);return"[object String]"==n||"[object Array]"==n?!!e.length:null!=e},IS:function(e,n,t){return!0===t?function(t,r,o){return n===o[e]}:function(t,r,o){return n==o[e]}},BETWEEN:function(e,n,t){if(e>n){var r=e;e=n,n=r}return!0===t?function(t){return t>e&&n>t}:function(t){return t>=e&&n>=t}},MATCHES:function(e){return function(n){return e.test(n)}},EXPRESSION:function(e){return new Function("value,key,model,index,model_key","return ("+e+");")}},Typecast:function(e,n){if(n)for(var t in n)if(n[A](t)){var r=n[t];if("[object Array]"===y.call(r)){if(e[A](t)){var o,i=e[t],u=i.length,r=r[0];for(o=0;u>o;o++)i[o]=r(i[o],t,e,o,i)}}else e[t]=r(e[t],t,e)}return e},Validate:function(e,n,t,r){var o=!0;if(r=r||"",n)for(var i in n)if(n[A](i)){var u=n[i];if("[object Array]"===y.call(u[0]))if(e[A](i)){var l,a=u[0][0],f=e[i],c=f.length,s=new Array(c),d=!1,h=u[1];for(l=0;c>l;l++)a(f[l],i,e,l,f)||(s[l]=h,d=!0);d&&(t[r+i]=s,o=!1)}else o=!1;else u[0](e[i],i,e)||(t[r+i]=u[1],o=!1)}return o},Key:t,Value:r,DataUriToBlob:u,FieldsToModel:o,UrlEncodedToModel:a,ModelToJSON:p,ModelToFormData:h,ModelToUrlEncoded:s}});