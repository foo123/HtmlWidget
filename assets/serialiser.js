/**
*  Serialiser.js
*  Parse, serialise and url-encode/decode complex form fields to/from an object model / FormData
*
*  @version: 0.4.0
*  https://github.com/foo123/serialiser.js
*
**/
!function(n,t,e){"use strict";"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(function(){return e()}):n[t]=e()}(this,"Serialiser",function(t){"use strict";function e(n,t){if("function"==typeof n)return n;if(t){var e=V("^"+P(t)+"([\\.\\[].+)$");return function(t){var r,o=t[j](n);return o&&(r=o.match(e))?r[1]:null}}return function(t){return t[j](n)}}function r(n,e){return"function"==typeof n?n:!1!==e?function(e){var r=("value"===n?D(e):e[j](n))||"",o=(e[j]("type")||e[x]||"").toLowerCase();return("checkbox"!==o&&"radio"!==o||e[E])&&("select"!==o||r.length&&-1!==e[L])&&("text"!==o&&"textarea"!==o||B(r).length)?r:t}:function(e){var r=("value"===n?D(e):e[j](n))||"",o=(e[j]("type")||e[x]).toLowerCase();return"checkbox"!==o&&"radio"!==o||e[E]?r:t}}function o(n,t,o,u,i,f){t=t||{},o=e(o||"name"),u=r(u||"value"),arguments.length<5&&(i=!1),f=!0===f;for(var c=0,l=n.length;l>c;c++){var a,s,p,g,h,d,v=n[c],b=!1,m=i?!!v[j](i):!1;if(a=o(v),a&&(s=u(v),null!=s)){m&&(s=s?I(s):null);var b=K.test(a);for(p=W(a).split("."),h=t;p.length;)g=p.shift(),p.length?(h[y](g)?!f&&H.test(p[0])&&h[g].length<=(d=parseInt(p[0],10))&&(h[g]=h[g].concat(new Array(d-h[g].length+1))):h[g]=b&&1===p.length?[]:!f&&H.test(p[0])?new Array(parseInt(p[0],10)+1):{},h=h[g]):b?h.push(s):h[g]=s}}return t}function u(t,e,r,o){e=e||{},r=!!r,o=!0===o;var u,f,c,a,s,p,g={"true":!0,"false":!1,"null":null,undefined:void 0};for(u=t.replace(/%20|\+/g," ").split("&"),i=0,l=u.length;l>i;i++){f=u[i].split("="),c=A(f[0]),a=f.length>1?A(f[1]):r?void 0:"",r&&(a=a&&!isNaN(a)&&+a+""===a?+a:"undefined"==typeof a?void 0:g[y][a]?g[a]:a);var h=K.test(c);for(c=W(c).split("."),s=e;c.length;)p=c.shift(),c.length?(s[y](p)?!o&&H.test(c[0])&&s[p].length<=(n=parseInt(c[0],10))&&(s[p]=s[p].concat(new Array(n-s[p].length+1))):s[p]=h&&1===c.length?[]:!o&&H.test(c[0])?new Array(parseInt(c[0],10)+1):{},s=s[p]):h?s.push(a):s[p]=a}return e}function f(n,t,e){"function"==typeof e&&(e=e()),n.push(S(t)+"="+S(null==e?"":e))}function c(n,t,e){var r,o,u;if(e)if(_(t))if(K.test(e))for(o=0,u=t.length;u>o;o++)f(n,e,t[o]);else for(o=0,u=t.length;u>o;o++)c(n,t[o],e+"["+("object"==typeof t[o]?o:"")+"]");else if(t&&"object"==typeof t)for(r in t)t[y](r)&&c(n,t[r],e+"["+r+"]");else f(n,e,t);else if(_(t))for(o=0,u=t.length;u>o;o++)f(n,t[o].name,t[o].value);else if(t&&"object"==typeof t)for(r in t)t[y](r)&&c(n,t[r],e);return n}function a(n,t,e){var r=c(t||[],n||{});return!0!==e&&(r=r.join("&").split("%20").join("+")),r}function s(n,t,e){"function"==typeof e&&(e=e()),n.append(t,null==e?"":e)}function p(n,t,e){var r,o,u;if(e)if(_(t))if(K.test(e))for(o=0,u=t.length;u>o;o++)s(n,e,t[o]);else for(o=0,u=t.length;u>o;o++)p(n,t[o],e+"["+("object"==typeof t[o]?o:"")+"]");else if(t&&"object"==typeof t)for(r in t)t[y](r)&&p(n,t[r],e+"["+r+"]");else s(n,e,t);else if(_(t))for(o=0,u=t.length;u>o;o++)s(n,t[o].name,t[o].value);else if(t&&"object"==typeof t)for(r in t)t[y](r)&&p(n,t[r],e);return n}function g(n,t){return p(t||new FormData,n||{})}function h(n){return m(n||{})}function d(){return!0}function v(){return!1}var y="hasOwnProperty",b=Object.prototype.toString,m=JSON.stringify,I=JSON.parse,S=encodeURIComponent,A=decodeURIComponent,j="getAttribute",E="checked",w="disabled",N="selected",x="tagName",O="type",T="value",C="options",L="selectedIndex",F="parentNode",R="innerText",$="textContent",U=function(n){var t=n.attributes[T];return!t||t.specified?n[T]:n.text},k=function(n){for(var t,e,r=n[C],o=n[L],u="select-one"===n[O]||0>o,i=u?null:[],f=u?o+1:r.length,c=0>o?f:u?o:0;f>c;c++)if(e=r[c],!(!e[N]&&c!==o||e[w]||e[F][w]&&"optgroup"===e[F][x].toLowerCase())){if(t=U(e),u)return t;i.push(t)}return i},D=function(n){if(n)switch(n[x].toLowerCase()){case"textarea":case"input":return n[T];case"select":return k(n);default:return $ in n?n[$]:n[R]}},M=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,P=function(n){return n.replace(M,"\\$&")},V=function(n,t){return new RegExp(n,t||"")},J=/^\s+|\s+$/g,B=String.prototype.trim?function(n){return n.trim()}:function(n){return n.replace(J,"")},H=/^\d+$/,X=/\[([^\]]*)\]/g,K=/\[\s*\]$/,Q=/^\.+/g,W=function(n){return n.replace(X,".$1").replace(Q,"")},_=function(n){return"[object Array]"===b.call(n)};return{VERSION:"0.4.0",Type:{COMPOSITE:function(){var n=arguments;return n[0]&&n[0].concat&&(n=n[0]),function(t,e,r,o,u){for(var i=n.length;i--;)t=n[i](t,e,r,o,u);return t}},DEFAULT:function(n){return function(t){return(null==t||"[object String]"===b.call(t)&&!B(t).length)&&(t=n),t}},BOOL:function(n){if("[object String]"===b.call(n)&&n.length){var t=n.toLowerCase();return"true"===t||"on"===t||"yes"===t||"1"===t}return!!n},INT:function(n){return parseInt(n||0,10)||0},FLOAT:function(n){return parseFloat(n||0,10)||0},STR:function(n){return String(n)},MIN:function(n){return function(t){return n>t?n:t}},MAX:function(n){return function(t){return t>n?n:t}},CLAMP:function(n,t){if(n>t){var e=t;t=n,n=e}return function(e){return n>e?n:e>t?t:e}}},Validator:{PASS:d,FAIL:v,NOT:function(n){return function(t,e,r,o,u){return!n(t,e,r,o,u)}},AND:function(n,t){return function(e,r,o,u,i){return n(e,r,o,u,i)&&t(e,r,o,u,i)}},EITHER:function(n,t){return function(e,r,o,u,i){return n(e,r,o,u,i)||t(e,r,o,u,i)}},IIF:function(n,t,e){return e=e||d,function(r,o,u,i,f){return n(r,o,u,i,f)?t(r,o,u,i,f):e(r,o,u,i,f)}},REQUIRED:function(n){var t=b.call(n);return"[object String]"==t||"[object Array]"==t?!!n.length:null!=n},IS:function(n,t,e){return!0===e?function(e,r,o){return t===o[n]}:function(e,r,o){return t==o[n]}},BETWEEN:function(n,t,e){if(n>t){var r=n;n=t,t=r}return!0===e?function(e){return e>n&&t>e}:function(e){return e>=n&&t>=e}},MATCHES:function(n){return function(t){return n.test(t)}},EXPRESSION:function(n){return new Function("value,key,model,index,model_key","return ("+n+");")}},Typecast:function(n,t){if(t)for(var e in t)if(t[y](e)){var r=t[e];if("[object Array]"===b.call(r)){if(n[y](e)){var o,u=n[e],i=u.length,r=r[0];for(o=0;i>o;o++)u[o]=r(u[o],e,n,o,u)}}else n[e]=r(n[e],e,n)}return n},Validate:function(n,t,e,r){var o=!0;if(r=r||"",t)for(var u in t)if(t[y](u)){var i=t[u];if("[object Array]"===b.call(i[0]))if(n[y](u)){var f,c=i[0][0],l=n[u],a=l.length,s=new Array(a),p=!1,g=i[1];for(f=0;a>f;f++)c(l[f],u,n,f,l)||(s[f]=g,p=!0);p&&(e[r+u]=s,o=!1)}else o=!1;else i[0](n[u],u,n)||(e[r+u]=i[1],o=!1)}return o},Key:e,Value:r,fromFields:o,fromUrlEncoded:u,toJSON:h,toFormData:g,toUrlEncoded:a}});