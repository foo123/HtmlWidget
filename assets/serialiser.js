/**
*  Serialiser.js
*  Parse, serialise and url-encode/decode complex form fields to/from an object model / FormData
*
*  @version: 0.5.0
*  https://github.com/foo123/serialiser.js
*
**/
!function(e,n,t){"use strict";"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(function(){return t()}):e[n]=t()}(this,"Serialiser",function(e){"use strict";function t(e,n){if("function"==typeof e)return e;if(n){var t=V("^"+P(n)+"([\\.\\[].+)$");return function(n){var r,o=n[T](e);return o&&(r=o.match(t))?r[1]:null}}return function(n){return n[T](e)}}function r(n,t){return"function"==typeof n?n:!1!==t?function(t){var r=("value"===n?k(t):t[T](n))||"",o=(t[T]("type")||t[E]||"").toLowerCase();return"file"===o?t.files.length?t.files:null:("checkbox"!==o&&"radio"!==o||t[w])&&("select"!==o||r.length&&-1!==t[L])&&("text"!==o&&"textarea"!==o||H(r).length)?r:e}:function(t){var r=("value"===n?k(t):t[T](n))||"",o=(t[T]("type")||t[E]).toLowerCase();return"file"===o?t.files.length?t.files:null:"checkbox"!==o&&"radio"!==o||t[w]?r:e}}function o(e,n,o,i,u,a){n=n||{},o=t(o||"name"),i=r(i||"value"),arguments.length<5&&(u=!1),a=!0===a;for(var f=0,c=e.length;c>f;f++){var l,s,d,h,p,g,v=e[f],y=!1,C=u?!!v[T](u):!1;if(l=o(v),l&&(s=i(v),null!=s)){C&&(s=s?b(s):null);var y=Q.test(l);for(d=_(l).split("."),p=n;d.length;)if(h=d.shift(),d.length){if(p[A](h))!a&&X.test(d[0])&&p[h].length<=(g=parseInt(d[0],10))&&(p[h]=p[h].concat(new Array(g-p[h].length+1)));else if(y&&1===d.length){if(s instanceof FileList){p[h]=s;break}p[h]=[]}else p[h]=!a&&X.test(d[0])?new Array(parseInt(d[0],10)+1):{};p=p[h]}else y?p.push(s):p[h]=s}}return n}function u(e,n){var t,r,o,i,u,a,f,c;for("data:"===e.substr(0,5)?(-1<(c=dataUri.indexOf(";base64,"))?(o=dataUri.slice(5,c),dataUri=dataUri.slice(c+8),t=m(dataUri)):(o=dataUri.slice(5,c=dataUri.indexOf(",")),dataUri=dataUri.slice(c+1),t=unescape(e)),null==n&&(n=o)):t=e,a=t.length,r=new Uint8Array(a),u=15&a,i=0;u>i;i++)r[i]=255&t.charCodeAt(i);for(i=u;a>i;i+=16)f=i,r[f]=255&t.charCodeAt(f++),r[f]=255&t.charCodeAt(f++),r[f]=255&t.charCodeAt(f++),r[f]=255&t.charCodeAt(f++),r[f]=255&t.charCodeAt(f++),r[f]=255&t.charCodeAt(f++),r[f]=255&t.charCodeAt(f++),r[f]=255&t.charCodeAt(f++),r[f]=255&t.charCodeAt(f++),r[f]=255&t.charCodeAt(f++),r[f]=255&t.charCodeAt(f++),r[f]=255&t.charCodeAt(f++),r[f]=255&t.charCodeAt(f++),r[f]=255&t.charCodeAt(f++),r[f]=255&t.charCodeAt(f++),r[f]=255&t.charCodeAt(f++);return new Blob([r],{type:n})}function a(e,t,r,o){t=t||{},r=!!r,o=!0===o;var u,a,f,c,s,d,h={"true":!0,"false":!1,"null":null,undefined:void 0};for(u=e.replace(/%20|\+/g," ").split("&"),i=0,l=u.length;l>i;i++){a=u[i].split("="),f=S(a[0]),c=a.length>1?S(a[1]):r?void 0:"",r&&(c=c&&!isNaN(c)&&+c+""===c?+c:"undefined"==typeof c?void 0:h[A][c]?h[c]:c);var p=Q.test(f);for(f=_(f).split("."),s=t;f.length;)d=f.shift(),f.length?(s[A](d)?!o&&X.test(f[0])&&s[d].length<=(n=parseInt(f[0],10))&&(s[d]=s[d].concat(new Array(n-s[d].length+1))):s[d]=p&&1===f.length?[]:!o&&X.test(f[0])?new Array(parseInt(f[0],10)+1):{},s=s[d]):p?s.push(c):s[d]=c}return t}function f(e,n,t,r){var o,i,u;if(r)if(q(n))if(Q.test(r))for(i=0,u=n.length;u>i;i++)t(e,r,n[i]);else for(i=0,u=n.length;u>i;i++)f(e,n[i],t,r+"["+("object"==typeof n[i]?i:"")+"]");else if(n instanceof FileList)for(i=0,u=n.length;u>i;i++)t(e,r,n[i]);else if(n instanceof File||n instanceof Blob)t(e,r,n);else if(n&&"object"==typeof n)for(o in n)n[A](o)&&f(e,n[o],t,r+"["+o+"]");else t(e,r,n);else if(q(n))for(i=0,u=n.length;u>i;i++)t(e,n[i].name,n[i].value);else if(n instanceof FileList)for(i=0,u=n.length;u>i;i++)t(e,r,n[i]);else if(n instanceof File||n instanceof Blob)t(e,r,n);else if(n&&"object"==typeof n)for(o in n)n[A](o)&&f(e,n[o],t,o);return e}function c(e,n,t){"function"==typeof t&&(t=t()),e.push(I(n)+"="+I(null==t?"":t))}function s(e,n,t){var r=f(n||[],e||{},c);return!0!==t&&(r=r.join("&").split("%20").join("+")),r}function d(e,n,t){if("function"==typeof t&&(t=t()),t instanceof FileList)for(var r=0,o=t.length;o>r;r++)e.append(n,t[r],t[r].name);else t instanceof File?e.append(n,t,t.name):e.append(n,null==t?"":t)}function h(e,n,t){return null==t&&"undefined"!=typeof FormData&&(t=FormData),t&&e instanceof t?e:f(n||new t,e||{},d)}function p(e){return C(e||{})}function g(){return!0}function v(){return!1}var A="hasOwnProperty",y=Object.prototype.toString,C=JSON.stringify,b=JSON.parse,m=atob,I=encodeURIComponent,S=decodeURIComponent,T="getAttribute",w="checked",F="disabled",U="selected",E="tagName",x="type",O="value",j="options",L="selectedIndex",N="parentNode",M="innerText",R="textContent",D=function(e){var n=e.attributes[O];return!n||n.specified?e[O]:e.text},$=function(e){for(var n,t,r=e[j],o=e[L],i="select-one"===e[x]||0>o,u=i?null:[],a=i?o+1:r.length,f=0>o?a:i?o:0;a>f;f++)if(t=r[f],!(!t[U]&&f!==o||t[F]||t[N][F]&&"optgroup"===t[N][E].toLowerCase())){if(n=D(t),i)return n;u.push(n)}return u},k=function(e){if(e)switch(e[E].toLowerCase()){case"textarea":case"input":return e[O];case"select":return $(e);default:return R in e?e[R]:e[M]}},B=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,P=function(e){return e.replace(B,"\\$&")},V=function(e,n){return new RegExp(e,n||"")},J=/^\s+|\s+$/g,H=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(J,"")},X=/^\d+$/,K=/\[([^\]]*)\]/g,Q=/\[\s*\]$/,W=/^\.+/g,_=function(e){return e.replace(K,".$1").replace(W,"")},q=function(e){return"[object Array]"===y.call(e)};return{VERSION:"0.5.0",Type:{COMPOSITE:function(){var e=arguments;return e[0]&&e[0].concat&&(e=e[0]),function(n,t,r,o,i){for(var u=e.length;u--;)n=e[u](n,t,r,o,i);return n}},DEFAULT:function(e){return function(n){return(null==n||"[object String]"===y.call(n)&&!H(n).length)&&(n=e),n}},BOOL:function(e){if("[object String]"===y.call(e)&&e.length){var n=e.toLowerCase();return"true"===n||"on"===n||"yes"===n||"1"===n}return!!e},INT:function(e){return parseInt(e||0,10)||0},FLOAT:function(e){return parseFloat(e||0,10)||0},STR:function(e){return String(e)},MIN:function(e){return function(n){return e>n?e:n}},MAX:function(e){return function(n){return n>e?e:n}},CLAMP:function(e,n){if(e>n){var t=n;n=e,e=t}return function(t){return e>t?e:t>n?n:t}}},Validator:{PASS:g,FAIL:v,NOT:function(e){return function(n,t,r,o,i){return!e(n,t,r,o,i)}},AND:function(e,n){return function(t,r,o,i,u){return e(t,r,o,i,u)&&n(t,r,o,i,u)}},EITHER:function(e,n){return function(t,r,o,i,u){return e(t,r,o,i,u)||n(t,r,o,i,u)}},IIF:function(e,n,t){return t=t||g,function(r,o,i,u,a){return e(r,o,i,u,a)?n(r,o,i,u,a):t(r,o,i,u,a)}},REQUIRED:function(e){var n=y.call(e);return"[object String]"==n||"[object Array]"==n?!!e.length:null!=e},IS:function(e,n,t){return!0===t?function(t,r,o){return n===o[e]}:function(t,r,o){return n==o[e]}},BETWEEN:function(e,n,t){if(e>n){var r=e;e=n,n=r}return!0===t?function(t){return t>e&&n>t}:function(t){return t>=e&&n>=t}},MATCHES:function(e){return function(n){return e.test(n)}},EXPRESSION:function(e){return new Function("value,key,model,index,model_key","return ("+e+");")}},Typecast:function(e,n){if(n)for(var t in n)if(n[A](t)){var r=n[t];if("[object Array]"===y.call(r)){if(e[A](t)){var o,i=e[t],u=i.length,r=r[0];for(o=0;u>o;o++)i[o]=r(i[o],t,e,o,i)}}else e[t]=r(e[t],t,e)}return e},Validate:function(e,n,t,r){var o=!0;if(r=r||"",n)for(var i in n)if(n[A](i)){var u=n[i];if("[object Array]"===y.call(u[0]))if(e[A](i)){var a,f=u[0][0],c=e[i],l=c.length,s=new Array(l),d=!1,h=u[1];for(a=0;l>a;a++)f(c[a],i,e,a,c)||(s[a]=h,d=!0);d&&(t[r+i]=s,o=!1)}else o=!1;else u[0](e[i],i,e)||(t[r+i]=u[1],o=!1)}return o},Key:t,Value:r,DataUriToBlob:u,FieldsToModel:o,UrlEncodedToModel:a,ModelToJSON:p,ModelToFormData:h,ModelToUrlEncoded:s}});