/**
*  Serialiser.js
*  Parse and serialise complex form fields into an object model
*
*  @version: 0.2.0
*  https://github.com/foo123/serialiser.js
*
**/
!function(n,t,e){"use strict";"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(function(){return e()}):n[t]=e()}(this,"Serialiser",function(n){"use strict";function t(n,t){if("function"==typeof n)return n;if(t){var e=m("^"+T(t)+"([\\.\\[].+)$");return function(t){var r,u=t[a](n);return u&&(r=u.match(e))?r[1]:null}}return function(t){return t[a](n)}}function e(t,e){return"function"==typeof t?t:!1!==e?function(e){var r=("value"===t?x(e):e[a](t))||"",u=(e[a]("type")||e[g]||"").toLowerCase();return("checkbox"!==u&&"radio"!==u||e[l])&&("select"!==u||r.length&&-1!==e[y])&&("text"!==u&&"textarea"!==u||L(r).length)?r:n}:function(e){var r=("value"===t?x(e):e[a](t))||"",u=(e[a]("type")||e[g]).toLowerCase();return"checkbox"!==u&&"radio"!==u||e[l]?r:n}}function r(n,r,u,o,c,l){r=r||{},u=t(u||"name"),o=e(o||"value"),arguments.length<5&&(c=!1),l=!0===l;for(var s=0,p=n.length;p>s;s++){var g,h,v,d,y,S,A=n[s],I=c?!!A[a](c):!1;if(g=u(A),g&&(h=o(A),null!=h))for(I&&(h=h?f(h):null),v=R(g).split("."),y=r;v.length;)d=v.shift(),v.length?(y[i](d)?!l&&N.test(v[0])&&y[d].length<=(S=parseInt(v[0],10))&&(y[d]=y[d].concat(new Array(S-y[d].length+1))):y[d]=1!==v.length||L(v[0]).length?!l&&N.test(v[0])?new Array(parseInt(v[0],10)+1):{}:[],y=y[d]):L(d).length?y[d]=h:y.push(h)}return r}function u(){return!0}function o(){return!1}var i="hasOwnProperty",c=Object.prototype.toString,f=JSON.parse,a="getAttribute",l="checked",s="disabled",p="selected",g="tagName",h="type",v="value",d="options",y="selectedIndex",S="parentNode",A="innerText",I="textContent",E=function(n){var t=n.attributes[v];return!t||t.specified?n[v]:n.text},b=function(n){for(var t,e,r=n[d],u=n[y],o="select-one"===n[h]||0>u,i=o?null:[],c=o?u+1:r.length,f=0>u?c:o?u:0;c>f;f++)if(e=r[f],!(!e[p]&&f!==u||e[s]||e[S][s]&&"optgroup"===e[S][g].toLowerCase())){if(t=E(e),o)return t;i.push(t)}return i},x=function(n){if(n)switch(n[g].toLowerCase()){case"textarea":case"input":return n[v];case"select":return b(n);default:return I in n?n[I]:n[A]}},w=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,T=function(n){return n.replace(w,"\\$&")},m=function(n,t){return new RegExp(n,t||"")},O=/^\s+|\s+$/g,L=String.prototype.trim?function(n){return n.trim()}:function(n){return n.replace(O,"")},N=/^\d+$/,C=/\[([^\]]*)\]/g,j=/^\.+/g,R=function(n){return n.replace(C,".$1").replace(j,"")};return{VERSION:"0.2.0",Type:{COMPOSITE:function(){var n=arguments;return n[0]&&n[0].concat&&(n=n[0]),function(t,e,r,u,o){for(var i=n.length;i--;)t=n[i](t,e,r,u,o);return t}},DEFAULT:function(n){return function(t){return(null==t||"[object String]"===c.call(t)&&!L(t).length)&&(t=n),t}},BOOL:function(n){if("[object String]"===c.call(n)&&n.length){var t=n.toLowerCase();return"true"===t||"on"===t||"yes"===t||"1"===t}return!!n},INT:function(n){return parseInt(n||0,10)||0},FLOAT:function(n){return parseFloat(n||0,10)||0},STR:function(n){return String(n)},MIN:function(n){return function(t){return n>t?n:t}},MAX:function(n){return function(t){return t>n?n:t}},CLAMP:function(n,t){if(n>t){var e=t;t=n,n=e}return function(e){return n>e?n:e>t?t:e}}},Validator:{PASS:u,FAIL:o,NOT:function(n){return function(t,e,r,u,o){return!n(t,e,r,u,o)}},AND:function(n,t){return function(e,r,u,o,i){return n(e,r,u,o,i)&&t(e,r,u,o,i)}},EITHER:function(n,t){return function(e,r,u,o,i){return n(e,r,u,o,i)||t(e,r,u,o,i)}},IIF:function(n,t,e){return e=e||u,function(r,u,o,i,c){return n(r,u,o,i,c)?t(r,u,o,i,c):e(r,u,o,i,c)}},REQUIRED:function(n){var t=c.call(n);return"[object String]"==t||"[object Array]"==t?!!n.length:null!=n},IS:function(n,t,e){return!0===e?function(e,r,u){return t===u[n]}:function(e,r,u){return t==u[n]}},BETWEEN:function(n,t,e){if(n>t){var r=n;n=t,t=r}return!0===e?function(e){return e>n&&t>e}:function(e){return e>=n&&t>=e}},MATCHES:function(n){return function(t){return n.test(t)}},EXPRESSION:function(n){return new Function("value,key,model,index,model_key","return ("+n+");")}},Key:t,Value:e,Model:r,Typecast:function(n,t){if(t)for(var e in t)if(t[i](e)){var r=t[e];if("[object Array]"===c.call(r)){if(n[i](e)){var u,o=n[e],f=o.length,r=r[0];for(u=0;f>u;u++)o[u]=r(o[u],e,n,u,o)}}else n[e]=r(n[e],e,n)}return n},Validate:function(n,t,e,r){var u=!0;if(r=r||"",t)for(var o in t)if(t[i](o)){var f=t[o];if("[object Array]"===c.call(f[0]))if(n[i](o)){var a,l=f[0][0],s=n[o],p=s.length,g=new Array(p),h=!1,v=f[1];for(a=0;p>a;a++)l(s[a],o,n,a,s)||(g[a]=v,h=!0);h&&(e[r+o]=g,u=!1)}else u=!1;else f[0](n[o],o,n)||(e[r+o]=f[1],u=!1)}return u}}});