/**
*  Serialiser.js
*  Parse, serialise and url-encode/decode complex form fields to/from an object model
*
*  @version: 0.3.0
*  https://github.com/foo123/serialiser.js
*
**/
!function(n,t,e){"use strict";"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(function(){return e()}):n[t]=e()}(this,"Serialiser",function(t){"use strict";function e(n,t){if("function"==typeof n)return n;if(t){var e=P("^"+F(t)+"([\\.\\[].+)$");return function(t){var r,u=t[I](n);return u&&(r=u.match(e))?r[1]:null}}return function(t){return t[I](n)}}function r(n,e){return"function"==typeof n?n:!1!==e?function(e){var r=("value"===n?R(e):e[I](n))||"",u=(e[I]("type")||e[m]||"").toLowerCase();return("checkbox"!==u&&"radio"!==u||e[A])&&("select"!==u||r.length&&-1!==e[E])&&("text"!==u&&"textarea"!==u||k(r).length)?r:t}:function(e){var r=("value"===n?R(e):e[I](n))||"",u=(e[I]("type")||e[m]).toLowerCase();return"checkbox"!==u&&"radio"!==u||e[A]?r:t}}function u(n,t,u,o,i,f){t=t||{},u=e(u||"name"),o=r(o||"value"),arguments.length<5&&(i=!1),f=!0===f;for(var c=0,a=n.length;a>c;c++){var l,s,p,h,v,y,A=n[c],S=!1,b=i?!!A[I](i):!1;if(l=u(A),l&&(s=o(A),null!=s)){b&&(s=s?d(s):null);var S=D.test(l);for(p=H(l).split("."),v=t;p.length;)h=p.shift(),p.length?(v[g](h)?!f&&U.test(p[0])&&v[h].length<=(y=parseInt(p[0],10))&&(v[h]=v[h].concat(new Array(y-v[h].length+1))):v[h]=S&&1===p.length?[]:!f&&U.test(p[0])?new Array(parseInt(p[0],10)+1):{},v=v[h]):S?v.push(s):v[h]=s}}return t}function o(t,e,r,u){e=e||{},r=!!r,u=!0===u;var o,f,c,a,s,p,h={"true":!0,"false":!1,"null":null,undefined:void 0};for(o=t.replace(/%20|\+/g," ").split("&"),i=0,l=o.length;l>i;i++){f=o[i].split("="),c=y(f[0]),a=f.length>1?y(f[1]):r?void 0:"",r&&(a=a&&!isNaN(a)&&+a+""===a?+a:"undefined"==typeof a?void 0:h[g][a]?h[a]:a);var d=D.test(c);for(c=H(c).split("."),s=e;c.length;)p=c.shift(),c.length?(s[g](p)?!u&&U.test(c[0])&&s[p].length<=(n=parseInt(c[0],10))&&(s[p]=s[p].concat(new Array(n-s[p].length+1))):s[p]=d&&1===c.length?[]:!u&&U.test(c[0])?new Array(parseInt(c[0],10)+1):{},s=s[p]):d?s.push(a):s[p]=a}return e}function f(n,t,e){"function"==typeof e&&(e=e()),n.push(v(t)+"="+v(null==e?"":e))}function c(n,t,e){var r,u,o;if(e)if(J(t))if(D.test(e))for(u=0,o=t.length;o>u;u++)f(n,e,t[u]);else for(u=0,o=t.length;o>u;u++)c(n,t[u],e+"["+("object"==typeof t[u]?u:"")+"]");else if(t&&"object"==typeof t)for(r in t)t[g](r)&&c(n,t[r],e+"["+r+"]");else f(n,e,t);else if(J(t))for(u=0,o=t.length;o>u;u++)f(n,t[u].name,t[u].value);else if(t&&"object"==typeof t)for(r in t)t[g](r)&&c(n,t[r],e);return n}function a(n,t,e){var r=c(t||[],n||{});return!0!==e&&(r=r.join("&").split("%20").join("+")),r}function s(){return!0}function p(){return!1}var g="hasOwnProperty",h=Object.prototype.toString,d=(JSON.stringify,JSON.parse),v=encodeURIComponent,y=decodeURIComponent,I="getAttribute",A="checked",S="disabled",b="selected",m="tagName",T="type",j="value",w="options",E="selectedIndex",x="parentNode",N="innerText",O="textContent",C=function(n){var t=n.attributes[j];return!t||t.specified?n[j]:n.text},L=function(n){for(var t,e,r=n[w],u=n[E],o="select-one"===n[T]||0>u,i=o?null:[],f=o?u+1:r.length,c=0>u?f:o?u:0;f>c;c++)if(e=r[c],!(!e[b]&&c!==u||e[S]||e[x][S]&&"optgroup"===e[x][m].toLowerCase())){if(t=C(e),o)return t;i.push(t)}return i},R=function(n){if(n)switch(n[m].toLowerCase()){case"textarea":case"input":return n[j];case"select":return L(n);default:return O in n?n[O]:n[N]}},M=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,F=function(n){return n.replace(M,"\\$&")},P=function(n,t){return new RegExp(n,t||"")},$=/^\s+|\s+$/g,k=String.prototype.trim?function(n){return n.trim()}:function(n){return n.replace($,"")},U=/^\d+$/,V=/\[([^\]]*)\]/g,D=/\[\s*\]$/,B=/^\.+/g,H=function(n){return n.replace(V,".$1").replace(B,"")},J=function(n){return"[object Array]"===h.call(n)};return{VERSION:"0.3.0",Type:{COMPOSITE:function(){var n=arguments;return n[0]&&n[0].concat&&(n=n[0]),function(t,e,r,u,o){for(var i=n.length;i--;)t=n[i](t,e,r,u,o);return t}},DEFAULT:function(n){return function(t){return(null==t||"[object String]"===h.call(t)&&!k(t).length)&&(t=n),t}},BOOL:function(n){if("[object String]"===h.call(n)&&n.length){var t=n.toLowerCase();return"true"===t||"on"===t||"yes"===t||"1"===t}return!!n},INT:function(n){return parseInt(n||0,10)||0},FLOAT:function(n){return parseFloat(n||0,10)||0},STR:function(n){return String(n)},MIN:function(n){return function(t){return n>t?n:t}},MAX:function(n){return function(t){return t>n?n:t}},CLAMP:function(n,t){if(n>t){var e=t;t=n,n=e}return function(e){return n>e?n:e>t?t:e}}},Validator:{PASS:s,FAIL:p,NOT:function(n){return function(t,e,r,u,o){return!n(t,e,r,u,o)}},AND:function(n,t){return function(e,r,u,o,i){return n(e,r,u,o,i)&&t(e,r,u,o,i)}},EITHER:function(n,t){return function(e,r,u,o,i){return n(e,r,u,o,i)||t(e,r,u,o,i)}},IIF:function(n,t,e){return e=e||s,function(r,u,o,i,f){return n(r,u,o,i,f)?t(r,u,o,i,f):e(r,u,o,i,f)}},REQUIRED:function(n){var t=h.call(n);return"[object String]"==t||"[object Array]"==t?!!n.length:null!=n},IS:function(n,t,e){return!0===e?function(e,r,u){return t===u[n]}:function(e,r,u){return t==u[n]}},BETWEEN:function(n,t,e){if(n>t){var r=n;n=t,t=r}return!0===e?function(e){return e>n&&t>e}:function(e){return e>=n&&t>=e}},MATCHES:function(n){return function(t){return n.test(t)}},EXPRESSION:function(n){return new Function("value,key,model,index,model_key","return ("+n+");")}},Typecast:function(n,t){if(t)for(var e in t)if(t[g](e)){var r=t[e];if("[object Array]"===h.call(r)){if(n[g](e)){var u,o=n[e],i=o.length,r=r[0];for(u=0;i>u;u++)o[u]=r(o[u],e,n,u,o)}}else n[e]=r(n[e],e,n)}return n},Validate:function(n,t,e,r){var u=!0;if(r=r||"",t)for(var o in t)if(t[g](o)){var i=t[o];if("[object Array]"===h.call(i[0]))if(n[g](o)){var f,c=i[0][0],a=n[o],l=a.length,s=new Array(l),p=!1,d=i[1];for(f=0;l>f;f++)c(a[f],o,n,f,a)||(s[f]=d,p=!0);p&&(e[r+o]=s,u=!1)}else u=!1;else i[0](n[o],o,n)||(e[r+o]=i[1],u=!1)}return u},Key:e,Value:r,FieldsToModel:u,ModelToParams:a,ParamsToModel:o}});